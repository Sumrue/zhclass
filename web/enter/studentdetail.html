<link href="{MODULE_URL}template/web/style/lessonTab/lesson-tab.css?v={$versions}" rel="stylesheet">
<script type="text/javascript" src="{MODULE_URL}template/web/style/lessonTab/prefixfree.min.js?v={$versions}"></script>
<style type="text/css">
	.flex{
		display: flex;
	}
	.center{
		text-align: center!important;
	}
	.wauto{
		width: auto!important;
	}
	.flex-end{
		justify-content: flex-end;
	}
	.add-areal{
		margin-left: 5%!important;
    border-bottom: 1px solid #ececec;
    padding-bottom: 10px;
	}
	.mb20{
		margin-bottom: 20px;
	}
	.ml20{
		margin-left: 20px;
	}
  @media (min-width: 768px){
    .form-horizontal .control-label {
      padding-top: 7px;
      margin-bottom: 0;
      text-align: center;
    }
  }
  .pay_box {
    display: none;
  }
</style>
<div class="main">
	<form action="" method="post" class="form-horizontal form" enctype="multipart/form-data">
		<div class="tab-group">
			<section id="tab1" title="学员报读信息" class="lesson-tab-section">
				<div class="panel-body">
          <!-- 姓名 -->
					<div class="form-group">
						<label class="col-xs-12 col-sm-3 col-md-2 control-label center"><span style="color:red;">*</span>姓名</label>
						<div class="col-sm-9">
							<input type="text" name="name" id="name" class="form-control" value="{$enter['name']}" />
						</div>
          </div>

          <!-- 电话号码 -->
					<div class="form-group">
						<label class="col-xs-12 col-sm-3 col-md-2 control-label center"><span style="color:red;">*</span> 电话号码</label>
						<div class="col-sm-9">
							<input type="text" name="name" id="mobile" class="form-control" value="{$enter['mobile']}" />
						</div>
          </div>

          <!-- 身份证 -->
					<div class="form-group">
						<label class="col-xs-12 col-sm-3 col-md-2 control-label center"><span style="color:red;">*</span> 身份证</label>
						<div class="col-sm-9">
							<input type="text" name="name" id="code" class="form-control" value="{$enter['code']}" />
						</div>
          </div>
          
          <!-- 状态 -->
					<div class="form-group">
						<label class="col-xs-12 col-sm-3 col-md-2 control-label"><span style="color:red;font-weight:bolder;">*</span>状态</label>
						<div class="col-sm-3">
							<select name="cid" class="form-control" id="status" onchange="statusChange()">
								<option value="0"{if $enter["status"] == 0}selected{/if}>意向学员</option>
								<option value="1"{if $enter["status"] == 1}selected{/if}>已报名</option>
								<option value="2"{if $enter["status"] == 2}selected{/if}>已缴费(全款)</option>
								<option value="3"{if $enter["status"] == 3}selected{/if}>已缴费(分期)</option>
								<option value="4"{if $enter["status"] == 4}selected{/if}>已结业</option>
							</select>
            </div>
            <!-- 当初始时状态不是已缴费才会在后面显示 -->
            {if $enter["status"] !== 2 || $enter["status"] !== 3}
            <div class="pay_box">
              <label class="col-sm-3" style="text-align: right;  color: red;height: 34px;line-height: 34px;">缴费金额</label>
              <div class="input-group col-sm-3">
                <input type="number" class="form-control" aria-label="Amount (to the nearest dollar)" value="0" id="pay">
                <span class="input-group-addon">元</span>
              </div>
            </div>
            {/if}
          </div>

          <!-- 报考类型 -->
					<div class="form-group">
						<label class="col-xs-12 col-sm-3 col-md-2 control-label"><span style="color:red;font-weight:bolder;">*</span>报考类型</label>
						<div class="col-sm-3">
							<select name="cid" class="form-control" id="type" onchange="typeChange(value)">
								<option value="1" {if $enter["cname"] == "成人高考"}selected{/if} >成人高考</option>
								<option value="2" {if $enter["cname"] == "开放教育"}selected{/if} >开放教育</option>
								<option value="3" {if $enter["cname"] == "自学考试"}selected{/if} >自学考试</option>
								<option value="4" {if $enter["cnmae"] == "网络教育"}selected{/if} >网络教育</option>
							</select>
						</div>
          </div>

          <!-- 报考学校 -->
					<div class="form-group">
						<label class="col-xs-12 col-sm-3 col-md-2 control-label"><span style="color:red;font-weight:bolder;">*</span>报考学校</label>
						<div class="col-sm-3">
							<select name="cid" class="form-control" id="school">
								<option value="">{$enter["sname"]}</option>
								{loop $class_list $class}
								<option value="{$class['id']}" {if $class['id']==$school['cid']}selected{/if}>{$class['name']}</option>
								{/loop}
							</select>
						</div>
          </div>

          <!-- 报考专业 -->
					<div class="form-group">
						<label class="col-xs-12 col-sm-3 col-md-2 control-label"><span style="color:red;font-weight:bolder;">*</span>报考专业</label>
						<div class="col-sm-3">
							<select name="cid" class="form-control" id="major">
								<option value="">{$enter["pname"]}</option>
								{loop $class_list $class}
								<option value="{$class['id']}" {if $class['id']==$school['cid']}selected{/if}>{$class['name']}</option>
								{/loop}
							</select>
						</div>
          </div>

          <!-- 报考层次 -->
					<div class="form-group">
						<label class="col-xs-12 col-sm-3 col-md-2 control-label"><span style="color:red;font-weight:bolder;">*</span>报考层次</label>
						<div class="col-sm-3">
							<select name="cid" class="form-control" id="level">
                <option value="">{$enter["lname"]}</option>
                {loop $class_list $class}
								<option value="{$class['id']}" {if $class['id']==$school['cid']}selected{/if}>{$class['name']}</option>
								{/loop}
							</select>
						</div>
          </div>

          <!-- 考试区县 -->
          <div class="form-group">
            <label class="col-xs-12 col-sm-3 col-md-2 control-label"><span style="color:red;font-weight:bolder;">*</span>考试区县</label>
						<div class="col-sm-3">
							<select name="cid" class="form-control" id="address">
                <option value="">{$enter["aid"]}</option>
                {loop $class_list $class}
								<option value="{$class['id']}" {if $class['id']==$school['cid']}selected{/if}>{$class['name']}</option>
								{/loop}
							</select>
						</div>
          </div>
          
				</div>
			</section>
		</div>
        <div class="form-group col-sm-12">
            <input type="submit" name="submit" value="保存" class="btn btn-primary col-lg-1" onclick="return add_school();"/>
            <input type="hidden" name="token" value="{$_W['token']}" />
			<input type="hidden" name="id" value="{$id}" />
			<input type="hidden" id="spec_list" name="spec_list" value="" />
			<input type="hidden" id="area_all" name="area_all" value="" />
        </div>
	</form>
</div>


<script type="text/javascript" src="{MODULE_URL}template/web/style/lessonTab/jquery-tab.js?v={$versions}"></script>
<script type="text/javascript">
var addr = {php echo json_encode($addr);};
var addr_p = {php echo $school['addr_p']?$school['addr_p']:0};
var addr_c = {php echo $school['addr_c']?$school['addr_c']:0};
var addr_t = {php echo $school['addr_t']?$school['addr_t']:0};
var html = '<option value="0">请选择一级分类</option>';
function check_area(label,id){
	var par=$(label).closest("div[id^='area_item_']").attr("id");
	if(par==0){
		return;
	}
	var area_list=$(label).closest("div[id^='area_list']").children();
	for(var i=0;i<area_list.length;i++){
		var area_item_id=$(area_list[i]).attr("id");
		if(area_item_id==par){
			continue;
		}
		var area_item_val=$(area_list[i]).find("#pro_addr_t").val();
		if(id==area_item_val){
			alert("不能选择重复的地区");
			$(label).val(0)
			break;
		}
	}
}
function check_pro(label,id){
	var par=$(label).closest("div[id^='pro_item_']").attr("id");
	var pro_item=$("#pro_new").children();
	for(var i=0;i<pro_item.length;i++){
		var pro_item_id=$(pro_item[i]).attr("id");
		if(pro_item_id==par){
			continue;
		}
		var pro_item_val=$(pro_item[i]).find("#pro_name").val();
		if(id==pro_item_val){
			alert("不能选择重复的专业");
			$(label).val(0)
			break;
		}
	}
}
function add_school(){
	var school_list=[];
	var pro_item=$("#pro_new").children();
	for(var i=0;i<pro_item.length;i++){
		var data={};
		var spec_id=$(pro_item[i]).find("#spec_id").val();
		if(spec_id!=null){
			data["id"]=spec_id;
		}
		data["name"]=$(pro_item[i]).find("#pro_name").val();
		data["price"]=$(pro_item[i]).find("#pro_price").val();
		data["oprice"]=$(pro_item[i]).find("#pro_oprice").val();
		data["unit"]=$(pro_item[i]).find("#pro_unit").val();
		school_list.push(data);
	}
	var area_list=[];
	var area_item=$("#area_list").children();
	for(var j=0;j<area_item.length;j++){
		var area={};
		area["pid"]=$(area_item[j]).find("#pro_addr_p").val();
		area["cid"]=$(area_item[j]).find("#pro_addr_c").val();
		area["tid"]=$(area_item[j]).find("#pro_addr_t").val();
		area_list.push(area);
	}
	$("#spec_list").val(JSON.stringify(school_list));
	$("#area_all").val(JSON.stringify(area_list));
	return true;
}

function add_area(){
	var new_html=$("#area_copy").html();
	var item_count=$('#area_list').children().length;
	var new_html = new_html.replace(new RegExp("######","g"), item_count);
	new_html="<div id=\"area_item_"+item_count+"\">"+new_html+"</div>";
	$("#area_list").append(new_html);
}

function render_pro(label,id,level=1){
	var se_pro;
	var ad_pro;
	var par=$(label).parent().next();
	if(level==1){
		se_pro=par.children("#pro_addr_c");
		ad_pro=addr_c;
	}else{
		se_pro=par.children("#pro_addr_t");
		ad_pro=addr_t;
	}
	var chtml = '<option value="0">请选择下级分类</option>';
	if(id>0){
		for(var i in addr){
			if(addr[i].pid==id){
				if(addr[i].id==ad_pro){
				chtml += '<option value="' + addr[i].id+'" selected>' + addr[i].name + '</option>';
				}else{
					chtml += '<option value="' + addr[i].id+'">' + addr[i].name + '</option>';
				}
			}
		}
		se_pro.html(chtml);
	}else{
		se_pro.html(chtml);
	}
}
$(function() {
	$(':radio[name="status"]').click(function() {
		if($(this).val() == '-1') {
			$('.reason-div').show();
		} else {
			$('.reason-div').hide();
		}
	});
	
	$(':radio[name="is_distribution"]').click(function() {
		if($(this).val() == '1') {
			$('.distribution-div').show();
		} else {
			$('.distribution-div').hide();
		}
	});

	$('.tab-group').tabify();
});
// 获取各个的值
let name = $('#name')
let mobile = $('#mobile')
let code = $('#code')
let status = $('#status')
let pay = $('#pay')
let type = $('#type')
let school = $('#school')
let major = $('#major')
let level = $('#level')
let address = $('#address')
// 状态改变时 显示金额窗口
function statusChange() {
  let val = $('#status').val()
  console.log(val)
  // 当选中状态为缴费状态时，金额窗口则显示
  if(val == 2 || val == 3) {
    $('.pay_box').css('display','block')
  } else {
    $('.pay_box').css('display','none')
  }
}
// 报读类型改变时 
function typeChange(val){
  console.log(val)
  school.html('<option selected >---请选择---</option>')
  major.html('<option selected >---请选择---</option>')
  level.html('<option selected >---请选择---</option>')
  address.html('<option selected >---请选择---</option>')
}

// 报考学校的重选

function schoolChange() {
  // 根据报读类型查询数据
}
</script>

<script>
  $(function(){
    let data = {php echo json_encode($enter)};
    console.log(data)
    // 页面初始化时就现根据报读类型来展示学校信息，避免在直接选择学校时无信息
    let school = [ // 请求到的信息
      {name: "学校1"},
      {name: "学校2"},
      {name: "学校3"},
      {name: "学校4"},
      {name: "学校5"}
    ]
    let schoolHtml = ''
    for(let i = 0; i < school.length; i++){
      schoolHtml = `
        <option value="">${school[i].name}</option>
      `
      $('#school').append(schoolHtml)
    }
  })
</script>

