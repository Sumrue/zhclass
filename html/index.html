<!-- 
 * ============================================================================
-->
{template $template.'/_headerv2'}
<div class="page-container">
	<header id="header">
		<nav class="nav">
			<ul>
				<li class="nav_item">成人高考</li>
				<li class="nav_item">开放教育</li>
				<li class="nav_item">自学考试</li>
				<li class="nav_item">职业教育</li>
				<!-- <div class="nav_item_line"></div> -->
			</ul>
		</nav>
	</header>

	<main id="main">
		<div class="index_main">
			<div class="panel_box">
				<!-- 成人高考 -->
				{template $template.'/adult_university'}
			</div>
			<div class="panel_box">
				<!-- 开放教育 -->
				{template $template.'/open_education'}
			</div>
			<div class="panel_box">
				<!-- 自学考试 -->
				{template $template.'/self_learn'}
			</div>
			<div class="panel_box"><h1>4</h1></div>
		</div>

	</main>

</div>

<script>
  $(function(){
		// 底部设置个人中心头像
		let userAA = {php echo json_encode($_W["fans"]["avatar"])}
		// window.localStorage.setItem('headImg',userAA)
		let footerSelfIcon = $('.self_footer_navbar')
		footerSelfIcon.attr("src",userAA)
		// 学员风采通用轮播 (包括证书展示)
		var studentShowSwiper = new Swiper ('.student_show_swiper', {
				loop: true,
				direction: 'horizontal', // 方向
				autoplay: 2000, // 切换时间
				slidesPerView :'auto',
				loopedSlides :3,
				centeredSlides: true,
				spaceBetween : 40,
				effect : 'coverflow',
				coverflow: {
									rotate: 0,
									depth: 130,
									slideShadows: false
							},
				observer:true,//修改swiper自己或子元素时，自动初始化swiper
				observeParents:true,//修改swiper的父元素时，自动初始化swiper
			})
		

		var voiceSwiper = new Swiper ('.voice_message_swiper', {
			loop: true,
			disableOnInteraction: false,
			direction: 'vertical', // 方向
			autoplay: 3000, // 切换时间
			slidesPerView: 3,
			spaceBetween : 40,
			onlyExternal: true,
			observer:true,//修改swiper自己或子元素时，自动初始化swiper
			observeParents:true,//修改swiper的父元素时，自动初始化swiper	

		})

		// 定义获取url参数的函数
		function getParameter (name) {
		let reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)", "i") // 配置正则
		let r = window.location.search.substr(1).match(reg) // 获取url,根据正则匹配url中的参数
		if (r != null) {
			return unescape(r[2]) //如果参数存在，则解码返回参数
			} else {
				return null // 参数不存在，返回null
			}
    }

		// 默认设置显示页面
		let panelBoxOnIndex = 0
		// 底部报读页面的选中，根据主页面选中，存入session中,设置ulr
		window.sessionStorage.setItem('apply_form_url',panelBoxOnIndex)
		let navItem = $('.nav_item')
    // let navItemLine = $('.nav_item_line')
    let navItemWd = navItem.width()
    let panelBox = $('.panel_box')
		console.log(panelBoxOnIndex)
    // 默认显示顶部导航设置，根据传入参数来设置

		navItem.eq(panelBoxOnIndex).addClass('nav_item_on').siblings().removeClass('nav_item_on') //  
		panelBox.eq(panelBoxOnIndex).addClass('panel_box_on').siblings().removeClass('panel_box_on') // 显示隐藏对应主面板

    // 设置导航下划线初始的宽度，为导航块的60%
    // navItemLine.css({
    //   width:navItemWd *.45,
    //   left:navItemWd * panelBoxOnIndex + navItemWd *.275 // 初始居中，剩余百分比除以2        默认下滑线位置
    // })


		// 报名成功轮播
		let banner = function(){
      let bannerApplyItems = $('.banner_apply_box')
      let itemIndex = $('.banner_tt_i').length
      let newItemIndex = itemIndex/3
      let itemHt = $('.banner_apply_item').height()
      var n = 0
      setInterval(() => {
        n ++
        if(n>newItemIndex-1) {
          n = 0
          bannerApplyItems.css('top',0)
        }
        bannerApplyItems.animate(
          {top: -itemHt*n}
        )
      },1500);
     }
    banner()

		// 成人教育报名人数滚动效果
		let numRoll = function(){
			let rollItems = $('.roll_small_items')
			rollItems.css('marginTop',0)
			let rollBox = $('.roll_box')
					// 根据传入值滚动
			let res = [1,3,2,6]
			rollItems.each(
				function(index){
					let $this = $(this)
					setTimeout(function(){
						$this.animate(
							{marginTop: - (5 + res[index] * 0.5) + 'rem'},
							{duration: 2000}
						)
					},300*index)
				}
			)
		}
		numRoll()

		// 开放教育报名人数滚动效果
		let openNumRoll = function(){
			let rollItems = $('.openroll_small_items')
			rollItems.css('marginTop',0)
			let rollBox = $('.openroll_box')
					// 根据传入值滚动
			let res = [4,6,9,0]
			rollItems.each(
				function(index){
					let $this = $(this)
					setTimeout(function(){
						$this.animate(
							{marginTop: - (5 + res[index] * 0.5) + 'rem'},
							{duration: 2000}
						)
					},300*index)
				}
			)
		}
		openNumRoll()

		// 自我考试报名人数滚动效果
		let selfNumRoll = function(){
			let rollItems = $('.selfroll_small_items')
			rollItems.css('marginTop',0)
			let rollBox = $('.selfroll_box')
					// 根据传入值滚动
			let res = [4,6,5,0]
			rollItems.each(
				function(index){
					let $this = $(this)
					setTimeout(function(){
						$this.animate(
							{marginTop: - (5 + res[index] * 0.5) + 'rem'},
							{duration: 2000}
						)
					},300*index)
				}
			)
		}
		selfNumRoll()

		// 评论区内容及数据的插入
		let voiceMsgHtml = function(){
      let vioceHtml = ''
      let voiceMsg = $('.voice_message_swiper>.swiper-wrapper')
      let voiceItem = $('.voice_message_swiper>.swiper-wrapper>.swiper-slide')
      let voiceData = [
        {userHead: '{MODULE_URL}template/mobile/default/images/index/voic_message_pic.jpeg',name: '没啊啊', question: '打发接收的阿斯顿发斯蒂芬阿道夫',answer: '打发接收的房间辣看时间傅雷家书阿萨德积分卡设计费拉卡机阿萨德解放啦'},
        {userHead: '{MODULE_URL}template/mobile/default/images/index/voic_message_pic.jpeg',name: '阿斯蒂芬', question: '打发接收的阿斯顿发斯蒂芬阿道夫',answer: '打发接收的房间辣看时间傅雷家书阿萨德积分卡设计费拉卡机阿萨德解放啦'},
        {userHead: '{MODULE_URL}template/mobile/default/images/index/voic_message_pic.jpeg',name: '按地方撒', question: '打发接收的阿斯顿发斯蒂芬阿道夫',answer: '打发接收的房间辣看时间傅雷家书阿萨德积分卡设计费拉卡机阿萨德解放啦'},
        {userHead: '{MODULE_URL}template/mobile/default/images/index/voic_message_pic.jpeg',name: '没嘎达啊啊', question: '打发接收的阿斯顿发斯蒂芬阿道夫',answer: '打发接收的房间辣看时间傅雷家书阿萨德积分卡设计费拉卡机阿萨德解放啦'},
        {userHead: '{MODULE_URL}template/mobile/default/images/index/voic_message_pic.jpeg',name: '刚打', question: '打发接收的阿斯顿发斯蒂芬阿道夫',answer: '打发接收的房间辣看时间傅雷家书阿萨德积分卡设计费拉卡机阿萨德解放啦'},
        {userHead: '{MODULE_URL}template/mobile/default/images/index/voic_message_pic.jpeg',name: '噶第三个', question: '打发接收的阿斯顿发斯蒂芬阿道夫',answer: '打发接收的房间辣看时间傅雷家书阿萨德积分卡设计费拉卡机阿萨德解放啦'},
        {userHead: '{MODULE_URL}template/mobile/default/images/index/voic_message_pic.jpeg',name: 'gas打发', question: '打发接收的阿斯顿发斯蒂芬阿道夫',answer: '打发接收的房间辣看时间傅雷家书阿萨德积分卡设计费拉卡机阿萨德解放啦'},
        {userHead: '{MODULE_URL}template/mobile/default/images/index/voic_message_pic.jpeg',name: '噶发送到', question: '打发接收的阿斯顿发斯蒂芬阿道夫',answer: '打发接收的房间辣看时间傅雷家书阿萨德积分卡设计费拉卡机阿萨德解放啦'},
        {userHead: '{MODULE_URL}template/mobile/default/images/index/voic_message_pic.jpeg',name: '啥都干的', question: '打发接收的阿斯顿发斯蒂芬阿道夫',answer: '打发接收的房间辣看时间傅雷家书阿萨德积分卡设计费拉卡机阿萨德解放啦'},
        {userHead: '{MODULE_URL}template/mobile/default/images/index/voic_message_pic.jpeg',name: '没啊啊', question: '打发接收的阿斯顿发斯蒂芬阿道夫',answer: '打发接收的房间辣看时间傅雷家书阿萨德积分卡设计费拉卡机阿萨德解放啦'},
        {userHead: '{MODULE_URL}template/mobile/default/images/index/voic_message_pic.jpeg',name: '没啊啊', question: '打发接收的阿斯顿发斯蒂芬阿道夫',answer: '打发接收的房间辣看时间傅雷家书阿萨德积分卡设计费拉卡机阿萨德解放啦'},
        {userHead: '{MODULE_URL}template/mobile/default/images/index/voic_message_pic.jpeg',name: '没啊啊', question: '打发接收的阿斯顿发斯蒂芬阿道夫',answer: '打发接收的房间辣看时间傅雷家书阿萨德积分卡设计费拉卡机阿萨德解放啦'},
        {userHead: '{MODULE_URL}template/mobile/default/images/index/voic_message_pic.jpeg',name: '没啊啊', question: '打发接收的阿斯顿发斯蒂芬阿道夫',answer: '打发接收的房间辣看时间傅雷家书阿萨德积分卡设计费拉卡机阿萨德解放啦'},
        {userHead: '{MODULE_URL}template/mobile/default/images/index/voic_message_pic.jpeg',name: '没啊啊', question: '打发接收的阿斯顿发斯蒂芬阿道夫',answer: '打发接收的房间辣看时间傅雷家书阿萨德积分卡设计费拉卡机阿萨德解放啦'},
        {userHead: '{MODULE_URL}template/mobile/default/images/index/voic_message_pic.jpeg',name: '没啊啊', question: '打发接收的阿斯顿发斯蒂芬阿道夫',answer: '打发接收的房间辣看时间傅雷家书阿萨德积分卡设计费拉卡机阿萨德解放啦'},
        {userHead: '{MODULE_URL}template/mobile/default/images/index/voic_message_pic.jpeg',name: '没啊啊', question: '打发接收的阿斯顿发斯蒂芬阿道夫',answer: '打发接收的房间辣看时间傅雷家书阿萨德积分卡设计费拉卡机阿萨德解放啦'},
        {userHead: '{MODULE_URL}template/mobile/default/images/index/voic_message_pic.jpeg',name: '没啊啊', question: '打发接收的阿斯顿发斯蒂芬阿道夫',answer: '打发接收的房间辣看时间傅雷家书阿萨德积分卡设计费拉卡机阿萨德解放啦'},
        {userHead: '{MODULE_URL}template/mobile/default/images/index/voic_message_pic.jpeg',name: '没啊啊', question: '打发接收的阿斯顿发斯蒂芬阿道夫',answer: '打发接收的房间辣看时间傅雷家书阿萨德积分卡设计费拉卡机阿萨德解放啦'},
        {userHead: '{MODULE_URL}template/mobile/default/images/index/voic_message_pic.jpeg',name: '没啊啊', question: '打发接收的阿斯顿发斯蒂芬阿道夫',answer: '打发接收的房间辣看时间傅雷家书阿萨德积分卡设计费拉卡机阿萨德解放啦'},
        {userHead: '{MODULE_URL}template/mobile/default/images/index/voic_message_pic.jpeg',name: '没啊啊', question: '打发接收的阿斯顿发斯蒂芬阿道夫',answer: '打发接收的房间辣看时间傅雷家书阿萨德积分卡设计费拉卡机阿萨德解放啦'},
        {userHead: '{MODULE_URL}template/mobile/default/images/index/voic_message_pic.jpeg',name: '没啊啊', question: '打发接收的阿斯顿发斯蒂芬阿道夫',answer: '打发接收的房间辣看时间傅雷家书阿萨德积分卡设计费拉卡机阿萨德解放啦'},
        {userHead: '{MODULE_URL}template/mobile/default/images/index/voic_message_pic.jpeg',name: '没啊啊', question: '打发接收的阿斯顿发斯蒂芬阿道夫',answer: '打发接收的房间辣看时间傅雷家书阿萨德积分卡设计费拉卡机阿萨德解放啦'}
      ]
      for(let i = 0; i < voiceData.length; i ++){
        let myname = voiceData[i].name
        vioceHtml += `
          <div class="swiper-slide">
            <div class="voice_message_item">
              <div class="message_item_pic fl">
                <img src="${voiceData[i].userHead}" alt="">
              </div>
              <div class="message_item fr">
                <p class="name">${myname.slice(0,1)}**</p>
                <p class="question">问：${voiceData[i].question}</p>
                <p class="reply">回复：<span>${voiceData[i].answer}</span></p>
              </div>
            </div>
          </div>	
        `
      }
      voiceMsg.append(vioceHtml)
    }
    voiceMsgHtml()

		// 学员故事分享
		let articHtml = function(){
      let ajaxurl = "{php echo $this->createMobileUrl('article', array('op'=>'list','cate_id'=>$_GPC['cate_id'],'method'=>'ajaxgetlist'));}";
      let articleurl = "{php echo $this->createMobileUrl('article');}";
      let get_status = true; //允许获取状态
      let getData = function () {  
        $.get(ajaxurl, function (data) {
          let jsonObj = JSON.parse(data);
          if (jsonObj.length !== 0) {
            insertDiv(jsonObj);
            console.log(jsonObj)
          }else{
            console.log('获取数据失败')  //没有数据后，禁止请求获取数据
          }
        })
      }
      getData()
			// 内容插入
      let insertDiv =  function(res){
        let storeItems = $('.student_story_items')
        let html = ''
        for(let i = 0; i<res.length; i++){
          html += `
            <a href="${articleurl}&aid=${res[i].id}" class="student_story_item">
              <div class="fl">
                <p class="store_title">${res[i].title}</p>
                <div class="story_left">
                  <div class="story_left_msg fl">
                    <div class="like">
                      <img src="{MODULE_URL}template/mobile/default/images/index/store_like.png" alt="">
                      <span >${res[i].view}</span>
                    </div>
                    <div class="read">
                      <img src="{MODULE_URL}template/mobile/default/images/index/store_eyes.png" alt="">
                      <span>${res[i].virtual_view}</span>
                    </div>
                  </div>
                  <span class="date fr">${res[i].addtime}</span>
                </div>
              </div>
              <div class="fr">
                <img src="${res[i].images}" alt="">
              </div>
              <div class="clear"></div>
            </a>
          `
        }
        storeItems.append(html)
      }
    }
		articHtml()
		
		
	// 点击切换顶部导航
		// 点击
    navItem.click(
      function(){
				let $this = $(this)
				let num = $this.index() // 获取当前nav的下标
				// 根据index来判断数字滚送效果是否重置
				if (num == 0 ) {
					numRoll()
				} else if (num == 1) {
					openNumRoll()
				} else if (num == 2) {
					selfNumRoll()
				} else {
					console.log('第四个页面')
				}
				// 存入下标，根据下标跳转页面
				window.sessionStorage.setItem('apply_form_url',num)
				// let oldLeft = parseInt(navItemLine.css('left'))// 获取下划线当前的位置
				$this.addClass('nav_item_on').siblings().removeClass('nav_item_on') //  添加移除nav选中样式

				// let itemLineMove = navItemWd * num + navItemWd *.275 // 计算left距离

				// 设置回调来重置swiper轮播，当页面切换成功之后在调用重置swiper轮播
				const setDelay = () => {
					return new Promise((resolve)=>{
						panelBox.eq(num).addClass('panel_box_on').siblings().removeClass('panel_box_on') // 显示隐藏对应主面板
						// 初始化轮播
						resolve('数据已接收') // 注意：一定要有返回值，否则，callback 将无法获取上一个 Promise 的结果。
					})
				}
				setDelay().then(resolve => {
					for(let i in studentShowSwiper){
						studentShowSwiper[i].init();
					}
					for(let i in voiceSwiper){
							voiceSwiper[i].init();
					}
				})
      }
		)

			// 中部内容导航切换
			let switchItemNav = $('.switch_item_nav')
			// let switchItemNavLine = $('.switch_item_line')
			// switchItemNavWd = switchItemNav.width()
			// switchItemNavLine.css({ 			// 下划线默认样式
			//   width:switchItemNavWd *.45 + '%', 
			//   left: switchItemNavWd *.275 + '%'// 初始居中，剩余百分比除以2        默认下滑线位置
			// })
			
			switchItemNav.click(function(){ // 点击时，切换导航时间
				let $this = $(this)
				let switchContent = $this.parent().parent().parent().find('.switch_content') // 找到当前点击对象所对应的内容区域
				$this.addClass('switch_item_nav_on').siblings().removeClass('switch_item_nav_on') // 选中样式的添加和移除
				let index = $this.index() // 获取下标
				// let moveWd = switchItemNavWd*index + switchItemNavWd *.275 + '%'// 定义移动的距离
				// // 下划线样式
				// let thisSwitchItemNavLine = $this.parent().find('.switch_item_line')
				// thisSwitchItemNavLine.animate(
				// 	{left: moveWd}, // 移动距离
				// 	{duration: 300} // 移动速度
				// )
				for(let i in studentShowSwiper){
							studentShowSwiper[i].init();
						}
				for(let i in voiceSwiper){
						voiceSwiper[i].init();
				}
				// 内容区域切换
				switchContent.eq(index).addClass('block').siblings().removeClass('block')  // 内容切换完成
			})

		// 合作学院点击展开效果
			let schoolItemBtn = $('.school_item_btn')
			schoolItemBtn.click(function(){
				let schoolItemBox = $('.school_item_box')
				schoolItemBox.animate(
					{height:'100%'},
					{direction: 1200}
				)
			})

		// 常见问题手风情效果
			$('.weui-cell').click(
				function(){
					let collapseCount = $(this).parent().children('.collapse_content') // 获取当前需要展开或者关闭的内容框
					let boxHt = collapseCount.children('.padding_box').height() // 动态获取盒子高度，方便内容过多时挤出去。需要设置默认高度时可以设置这个为固定值，例如60
					let collIcon = $(this).children('.left_icon')
					let collapseHt = collapseCount.height() // 获取当前内容框的高度，是否展开

					// 首先将其他已展开或未展开的内容框重置为零，即手风琴效果，如不需要手风琴效果就可以去掉下面重置两项
					collapseCount.parent().siblings().children('.collapse_content').animate( // 重置其他的选项
							{height: 0},
							{duration: 200}
					)
					$('.left_icon').addClass('weui-cell__ft').removeClass('weui-cell__ft_on') // 变化前箭头全部重置为初始状态

					// 判断当前是否展开，即高度是否为零，已展开点击栏目时关闭
					if(collapseHt !== 0) { // 已展开时
							collIcon.removeClass('weui-cell__ft_on').addClass('weui-cell__ft') // 加入箭头向下的样式移除原样式
							collapseCount.animate(
									{height: 0},
									{duration: 200}
							)
					} else {
							collIcon.addClass('weui-cell__ft_on').removeClass('weui-cell__ft')
							collapseCount.animate(
									{height: boxHt + 35}, // 有个BUG，必须要加20 不然盒子展开少一截，我也不知道错在哪儿。。。。。
									{duration: 200}
							)
					}
				}
			)		
		
		// 监听评论功能输入时的输入限制显示
			$(".voice_box").on('input propertychange', function () {
				//获取输入内容
				let userDesc = $(this).val();
				//判断字数
				let len = userDesc.length
				if (len<=50) {
					$(".main_num").html(len + '/50')
				} else {
						return
				}
				//显示字数
			});

		// 获取滚动事件 
		$(window).scroll(
			function(){
				let windowHt = $(this).scrollTop()
				let headerHt = $('#header').height()
				let bannerHt = $('.banner').height()
				let mainContentBox1Wd = $('.main_content_box1').height()
				let switchItem = $('.main_content_box1 .switch_item') // 通用第一个导航到顶部设置
				let switchItem2 = $('.adult_university .main_content_box2 .switch_item')
				let switchItemHt = switchItem.height() // 内容切换导航的自身高度

				// 中部内容切换导航到header位置时，逐渐盖住header
				if(windowHt > bannerHt ){
					$('#header').addClass('z-index0') // header层级变低
					$('.banner').addClass('hidden')
				} else if(windowHt <  headerHt + bannerHt) {
					$('#header').removeClass('z-index0')
					$('.banner').removeClass('hidden')
				}

				// 中部内容切换导航到顶部时固定顶部，header消失
				if(windowHt >  headerHt + bannerHt){ 
					switchItem.addClass('fixed')
				} else if(windowHt <  headerHt + bannerHt) {
					switchItem.removeClass('fixed')
				}

				// 第二个中部导航滚动到指定位置设置
				if(windowHt >  headerHt + bannerHt + mainContentBox1Wd){ 
					switchItem2.addClass('fixed')
				} else if(windowHt <  headerHt + bannerHt + mainContentBox1Wd) {
					switchItem2.removeClass('fixed')
				}

			}
		)

    $(document).scroll(
      function(){

      }
		)
	})
</script>

{template $template.'/_footerv2'}