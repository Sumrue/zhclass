<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
		<meta name="format-detection" content="telephone=no">
		<meta name="full-screen" content="yes">
		<meta name="browsermode" content="application">
		<meta name="x5-orientation" content="portrait">
		<meta name="x5-fullscreen" content="true">
    <meta name="x5-page-mode" content="app">
    <link rel="stylesheet" href="https://res.wx.qq.com/open/libs/weui/2.0.1/weui.min.css">
    <link rel="stylesheet" href="{MODULE_URL}template/mobile/{$template}/style/cssv2/swiper.min.css?v={$versions}" />
    <link rel="stylesheet" href="{MODULE_URL}template/mobile/{$template}/style/cssv2/index.css?v={$versions}"/>
		<title>
      学院名称
    </title>
    <style>
      .panel_on {
        display: block !important;
      }
      .school_detail {
        margin-bottom: 1.2rem;
      }
      .school_detail .top_pic {
        width: 100%;
      }
      .school_detail .top_pic img{
        width: 100%;
        height: 2.3rem;
        object-fit: cover;
        display: block
      }
      /* 头部导航 */
      .school_detail_navbar {
        width: 100%;
        height: 1rem;
        line-height: 1rem;
        display: flex;
      }
      .school_detail_navbar .school_navbar_item {
        flex: 1;
        height: 100%;
        background-color: #fff;
        text-align: center;
      }

      .school_navbar_on {
        color: #F25562;
        position: relative;
      }
      .school_navbar_on::after {
        content: "";
        position: absolute;
        width: .6rem;
        height: 2px;
        left: .9rem;
        bottom: .04rem;
        background-color: #F25562;
        border-radius: 2px;
        box-sizing: border-box;
      }
      .school_panel {
        background-color: #fff;
        padding-bottom: .5rem;
      }
      .school_panel .panel {
        display: none;
      }

      /* 招生主页 */
      .recruit_student_main>.school_gift {
        width: 100%;
        height: 7.1rem;
        background: url({MODULE_URL}template/mobile/{$template}/images/index/school_detail/school_gift_bigbg.png) no-repeat;
        background-size: 100%;
        position: relative;
        display:block;
      }

      .school_gift>.gift_title {
        position: absolute;
        width: 2.9rem;
        height: .4rem;
        text-align: center;
        background: url({MODULE_URL}template/mobile/{$template}/images/index/school_detail/school_gift_titlebg.png) no-repeat;
        background-size: 100%;
        top: 1.8rem;
        left: 2.3rem;
        display:block;
      }
      .gift_title>.price {
        text-decoration:line-through
      }
      .recruit_student_main .gift_text {
        width: 6.25rem;
        font-size: .28rem;
        position: absolute;
        top: 2.4rem;
        left: 1.2rem;
      }

      .gift_text .star {
        width: .24rem;
        margin: 0 .1rem
      }
      .gift_text .star img {
        width: .24rem;
        object-fit: cover;
      }
      .recruit_student_main .gift_text p {
        margin-bottom: .2rem;
      }
      .gift_text>.bottom_text {
        color: rgba(23,6,6,.4);
        margin-left: .1rem;
      }

      .gift_btn{
        border: none;
        width: 2rem;
        height: .7rem;
        line-height: .7rem;
        text-align: center;
        background: #fff;
        -webkit-box-shadow: 0 3px 0 0 #fb6a14;
        box-shadow: 0 3px 0 0 #fb6a14;
        border-radius: .4rem;
        font-weight: 600;
        font-size: .32rem;
        color: #f06e6c;
        position: absolute;
        top: 5.6rem;
        left: 2.7rem;
      } 
      /* 专业以及收费 */
      .recruit_student_main>.major_money {
        width: 96%;
        margin: 0 auto;
      }
      .major_money>.title {
        height: .8rem;
        line-height: .6rem;
        font-size: .32rem;
        margin-bottom: .3rem;
      }
      .major_money>.title>img {
        width: .64rem;
        height: .64rem;
        vertical-align: bottom;
      }
      .major_money>.content {
        width: 100%;
      }
      .major_money>.content img {
        width: 100%;
        object-fit: cover;
      }

      /* 上进故事 */
      .good_story {
        width: 96%;
        margin: 0 auto;
      }
      .good_story>.title {
        height: .8rem;
        line-height: .6rem;
        font-size: .32rem;
        margin-bottom: .3rem;
      }
      .good_story>.title>img {
        width: .64rem;
        height: .64rem;
        vertical-align: bottom;
      }
      .good_story_banner {
        width: 100%;
        margin-bottom: .3rem;
        white-space:nowrap;
        overflow-x:scroll;
        overflow-y:hidden
      }
      .good_story_items {
        display: flex;
        margin-bottom: .2rem;
      }
      .good_story_item {
        width: 3.1rem;
        height: 5.2rem;
        margin-right: .3rem;
        border-radius: 5px;
        position: relative;
        -webkit-box-shadow: 0 2px 3px 0 rgba(0,0,0,.06), 0 2px 3px 0 rgba(0,0,0,.04), 0 4px 6px 0 rgba(0,0,0,.04);
        box-shadow: 0 2px 3px 0 rgba(0,0,0,.06), 0 2px 3px 0 rgba(0,0,0,.04), 0 4px 6px 0 rgba(0,0,0,.04);
      }
      .good_story_item>.pic {
        width: 3.1rem;
      }
      .good_story_item>.pic img{
        width: 100%;
        border-top-left-radius: 5px;
        border-top-right-radius: 5px;
      }
      .good_story_item>.text {
        font-size: .26rem;
        margin: .2rem 0 .3rem .1rem;
        color: rgba(23,6,6,.8);
        white-space: normal;
        display: -webkit-box;
        -webkit-box-orient: vertical;
        -webkit-line-clamp: 3;
        overflow: hidden;
      }
      .good_story_item>.date {
        position: absolute;
        font-size: .24rem;
        color: rgb(0,0,0,.4);
        left: .05rem;
        bottom: .1rem;
      }

      /* 留言区 */
      .school_voice_box {
        padding-bottom: 1rem;
      }
      .school_voice_msg {
        width: 100%;
        margin: 0 auto;
        background-color: #fff;
        padding: 0 .3rem;
        box-sizing: border-box;
      }
      .school_voice_msg .voice_message .message_item {
        width: 5.5rem;
      }
      .school_voice_msg>.title {
        height: .8rem;
        line-height: .6rem;
        font-size: .32rem;
        margin-bottom: .3rem;
      }
      .school_voice_msg>.title>img {
        width: .64rem;
        height: .64rem;
        vertical-align: bottom;
      }

      /* 学校介绍 */
      .detail_content_head {
        width: 100%;
        padding: .1rem .1rem;
        box-sizing: border-box;
      }
      .detail_content_head .img_box {
        width: 100%;
        margin-bottom: .5rem;

      }
      .detail_content_head .img_box img{
        width: 100%;
        border-radius: 5px;
      }
      .detail_content_head>.text {
        width: 6rem;
        height: 3rem;
        overflow: hidden;
        font-size: .28rem;
        margin: 0 auto;
        text-indent:25px
      }
      .look_more {
        width: 100%;
      }
      .look_more>.more {
        width: 2rem;
        text-align: center;
        margin: 0 auto;
        font-size: .3rem;
        color: rgb(0,0,0,.4);
      }
      .look_more>.more>img {
        width: .8rem;
        object-fit: cover;
        margin-bottom: -.2rem;
      }
      .look_more>.up {
        width: 1rem;
        height: 1rem;
        font-size: .32rem;
        line-height: 1rem;
        text-align: center;
        margin: 0 auto;
        color:rgb(0,0,0,.4);
      }
      .lookHidden {
        display: none !important;
      }

      /* 学员风采 */
      .school_detail_student {
        width: 96%;
        margin: 0 auto;
      }
      .school_detail_student>.title {
        height: .8rem;
        line-height: .6rem;
        font-size: .32rem;
        margin-bottom: .3rem;
      }
      .school_detail_student>.title>img {
        width: .64rem;
        height: .64rem;
        vertical-align: bottom;
      }
      .school_detail_student .student_show>.foure_advantage_title {
        display: none;
      }
    </style>
		<script type="text/javascript">
		//去除系统弹出框网址标题
		window.alert = function(name){
			 var iframe = document.createElement("IFRAME");
			 iframe.style.display="none";a
			 document.documentElement.appendChild(iframe);
			 window.frames[0].window.alert(name);
			 iframe.parentNode.removeChild(iframe)
		}
		</script>
  </head>
	<body data-weui-theme="light">
		<div class="page-container" id="page-container">
			<div class="school_detail">
        <div class="top_pic">
          <img src="{$_W['attachurl']}{$school['banner']}" alt="">
        </div>
        <!-- 切换导航 -->
        <div class="school_detail_navbar">
          <div class="school_navbar_item school_navbar_on">招生主页</div>
          <div class="school_navbar_item">学校介绍</div>
          <div class="school_navbar_item">常见问题</div>
        </div>

        <div class="school_panel">
          <div class="panel panel_on">
            <div class="recruit_student_main">
              <!-- 上进礼包 -->
              <div class="school_gift">
                <div class="gift_title">
                  <span class="sale_price">666</span>元(原价<span class="price">888</span>元)
                </div>
                <div class="gift_text">
                  <p>
                    <i class="star"><img src="{MODULE_URL}template/mobile/{$template}/images/index/school_detail/star.png" alt=""></i>
                    <span>考前辅导课(原价600, 抢购价199)</span>
                  </p>
                  <p>
                    <i class="star"><img src="{MODULE_URL}template/mobile/{$template}/images/index/school_detail/star.png" alt=""></i>
                    <span>三本辅导教材(原价114, 抢购价100)</span>
                  </p>
                  <p>
                    <i class="star"><img src="{MODULE_URL}template/mobile/{$template}/images/index/school_detail/star.png" alt=""></i>
                    <span>成考过295分, 奖励三年全额奖学金</span>
                  </p>
                  <p class="bottom_text">(上述考分不含政策性加分)</p>
                </div>
                  <a href="{php echo $this->createMobileUrl('adultuserform', array('do'=>'adultuserform','type'=>'adult','exist299'=>'true','cid'=>'1'));}" class="gift_btn">
                    立即购买
                  </a>
              </div>

              <!-- 院校专业以及收费 -->
              <div class="major_money">
                <div class="title">
                  <img src="{MODULE_URL}template/mobile/{$template}/images/index/school_detail/major_money_title.png" alt="">
                  <span>院校专业及收费</span>
                </div>
                <div class="content">
                  <img src="{MODULE_URL}template/mobile/{$template}/images/index/school_detail/major_money_center.png" alt="">
                </div>
              </div>

              <!-- 上进故事 -->
              <div class="good_story">
                <div class="title">
                  <img src="{MODULE_URL}template/mobile/{$template}/images/index/school_detail/good_story_icon.png" alt="">
                  <span>上进故事</span>
                </div>
                <div class="good_story_banner">
                  <ul class="good_story_items">
                    <div class="clear"></div>
                  </ul>

                  <!-- 邀请有礼广告 -->
                  <div></div>
                </div>
              </div>
            </div>
          </div>
          <div class="panel">
            <!-- 学校介绍 -->
            <div class="school_detail_content">
              <!-- 介绍顶部 -->
              <div class="detail_content_head">
                <div class="img_box">
                  <img src="{MODULE_URL}template/mobile/{$template}/images/index/school_detail/school_detail_pic.png" alt="">
                </div>
                <div class="text" id="mydiv">
                  
                </div>
              </div>
            </div>
            <div class="look_more">
              <div class="more">
                <img src="{MODULE_URL}template/mobile/{$template}/images/index/open_education/down_more.png" alt="">
                <p>查看更多</p>
              </div>
              <div class="up lookHidden">
                收起
              </div>
            </div>
            
            <!-- 学员风采 -->
            <div class="school_detail_student">
              <div class="title">
                <img src="{MODULE_URL}template/mobile/{$template}/images/index/school_detail/school_detail_stdenticon.png" alt="">
                <span>学员风采</span>
              </div>
            </div>
            {template $template.'/index/student_show'}
            <!-- 邀请好友广告位 -->
            <div></div>
          </div>
          <div class="panel">
            {template $template.'/index/question_list'}
          </div>
        </div>
        <!-- 留言区 -->
        <div class="school_voice_msg">
          <div class="title">
            <img src="{MODULE_URL}template/mobile/{$template}/images/index/school_detail/voice_msg_icon.png" alt="">
            <span>留言区</span>
          </div>
          <div class="school_voice_box">
            {template $template.'/index/voice2'}
          </div>
        </div>
      </div>
    </div>
    <script type="text/javascript" src="{MODULE_URL}template/mobile/{$template}/style/jsv2/jquery.min.js?v={$versions}"></script>
    <script type="text/javascript" src="{MODULE_URL}template/mobile/{$template}/style/jsv2/swiper.3.4.1.min.js"></script>
    <script type="text/javascript" src="{MODULE_URL}template/mobile/{$template}/style/js/m-fit.js"></script>
    <script type="text/javascript" src="https://res.wx.qq.com/open/libs/weuijs/1.2.1/weui.min.js"></script>
    <script>
      $(function(){
          // 对接收到的文章进行处理
          function escape2Html(str) { 
            var arrEntities={'lt':'<','gt':'>','nbsp':' ','amp':'&','quot':'"'}; 
            return str.replace(/&(lt|gt|nbsp|amp|quot);/ig,function(all,t){return arrEntities[t];}); 
            }
          let strrr = {php echo json_encode($school)};
          let schollText = $('.detail_content_head .text')
          console.log(strrr)
          let contenttext = '{php echo json_encode($school['content'])}'
          let text = escape2Html(contenttext)
          let length = text.length
          let text2 = text.substr(1,length-2)
          $('#mydiv').html(text2)
        // 留言区swiper滚动
          let voiceSwiper = new Swiper ('.voice_message_swiper', {
            loop: true,
            disableOnInteraction: false,
            direction: 'vertical', // 方向
            autoplay: 3000, // 切换时间
            slidesPerView: 3,
            spaceBetween : 40,
            onlyExternal: true,
            observer:true,//修改swiper自己或子元素时，自动初始化swiper
            observeParents:true,//修改swiper的父元素时，自动初始化swiper	
          })

          let studentShowSwiper = new Swiper ('.student_show_swiper', {
            loop: true,
            direction: 'horizontal', // 方向
            autoplay: 2000, // 切换时间
            slidesPerView :'auto',
            loopedSlides :3,
            centeredSlides: true,
            spaceBetween : 40,
            effect : 'coverflow',
            coverflow: {
                      rotate: 0,
                      depth: 130,
                      slideShadows: false
                  },
            observer:true,//修改swiper自己或子元素时，自动初始化swiper
            observeParents:true,//修改swiper的父元素时，自动初始化swiper
          }) 

        // 监听评论功能输入时的输入限制显示
        $(".voice_box").on('input propertychange', function () {
          //获取输入内容
          let userDesc = $(this).val();
          //判断字数
          let len = userDesc.length
          if (len<=50) {
            $(".main_num").html(len + '/50')
          } else {
              return
          }
          //显示字数
        });

        // 导航和页面的切换
        let navBarItem = $('.school_navbar_item')
        let schoolPanel = $('.school_panel .panel')
        navBarItem.click(function(){
          let $this = $(this)
          let index = $this.index()
          $this.addClass('school_navbar_on').siblings('.school_navbar_on').removeClass('school_navbar_on') // 导航切换
          schoolPanel.eq(index).addClass('panel_on').siblings('.panel_on').removeClass('panel_on') // 页面切换

          // 常见问题页面中隐藏品论
          let vioceMsg = $('.school_voice_msg')
          if(index == 2) {
            vioceMsg.css('display','none')
          } else {
            vioceMsg.css('display','block')
          }

          // 初始化spiper轮播 去除display的影响
          studentShowSwiper.init();
          voiceSwiper.init();
        })

        // 学校介绍内容的展开关闭
        let schoolText  = $('.school_detail_content .text')
        let lookMore = $('.look_more .more')
        let closeMore = $('.look_more .up')
        lookMore.click(function(){
          $(this).addClass('lookHidden')
          closeMore.removeClass('lookHidden')
          schoolText.height('100%')
        })
        closeMore.click(function(){
          $(this).addClass('lookHidden')
          lookMore.removeClass('lookHidden')
          schoolText.height('3rem')
        })

        // 常见问题展开关闭代码
        let wuiCell = $('.weui-cell')
        let leftIcon = $('.left_icon')
        wuiCell.click(
				function(){
					let collapseCount = $(this).parent().children('.collapse_content') // 获取当前需要展开或者关闭的内容框
					let boxHt = collapseCount.children('.padding_box').height() // 动态获取盒子高度，方便内容过多时挤出去。需要设置默认高度时可以设置这个为固定值，例如60
					let collIcon = $(this).children('.left_icon')
					let collapseHt = collapseCount.height() // 获取当前内容框的高度，是否展开

					// 首先将其他已展开或未展开的内容框重置为零，即手风琴效果，如不需要手风琴效果就可以去掉下面重置两项
					collapseCount.parent().siblings().children('.collapse_content').animate( // 重置其他的选项
							{height: 0},
							{duration: 200}
					)
					leftIcon.addClass('weui-cell__ft').removeClass('weui-cell__ft_on') // 变化前箭头全部重置为初始状态

					// 判断当前是否展开，即高度是否为零，已展开点击栏目时关闭
					if(collapseHt !== 0) { // 已展开时
							collIcon.removeClass('weui-cell__ft_on').addClass('weui-cell__ft') // 加入箭头向下的样式移除原样式
							collapseCount.animate(
									{height: 0},
									{duration: 200}
							)
					} else {
							collIcon.addClass('weui-cell__ft_on').removeClass('weui-cell__ft')
							collapseCount.animate(
									{height: boxHt + 35}, // 有个BUG，必须要加20 不然盒子展开少一截，我也不知道错在哪儿。。。。。
									{duration: 200}
							)
            }
          }
        )
        
        // 主页留言的请求与提交
        let voiceAjaxurl = "{php echo $this->createMobileUrl('evaluate', array('op'=>'getfree','method'=>'ajaxgetlist'));}"
        let voiceGetData = function () {
          $.get(voiceAjaxurl, function (data) {
            let voiceData = []
            if (data.length !== 0) {
              voiceData = JSON.parse(data)
              console.log(voiceData)
            }else{
              console.log('获取数据失败')  //没有数据后，禁止请求获取数据
            }
          }).then(res=>{
            let voiceData = JSON.parse(res)
            let data = voiceData.list
            console.log(data)
            let voiceMsg = $('.voice_message_swiper>.swiper-wrapper')
            let voiceItem = $('.voice_message_swiper>.swiper-wrapper>.swiper-slide')
            let vioceHtml = ''
            for(let i = 0; i < data.length; i ++){
            let myname = data[i].nickname
            let reply = data[i].reply
            if(data[i].reply == null ) {
              reply = ''
            } else {
              reply = data[i].reply
            }
            vioceHtml += `
              <div class="swiper-slide">
                <div class="voice_message_item">
                  <div class="message_item_pic fl">
                    <img src="${data[i].avatar}" alt="">
                  </div>
                  <div class="message_item fr">
                    <p class="name">${myname.slice(0,1)}**</p>
                    <p class="question">问：${data[i].content}</p>
                    <p class="reply">回复：<span>${reply}</span></p>
                  </div>
                </div>
              </div>	
            `
          }
          voiceMsg.append(vioceHtml)
          })
        }
        voiceGetData()

        // 提交
        let voiceSubmit = $('.voice_message_btn')
        voiceSubmit.click(function(){
              // 获取留言框中的内容
          let content = $('.voice_box').val()
          // let voicePostAjaxurl = "{php echo $this->createMobileUrl('evaluate', array('op'=>'free','method'=>'ajaxgetlist'));}" + '&grade=' + 1 + '&global_score=' + 1 + '&content_score=' + 1 + '&understand_score=' + 1 + '&content=' + content
          let voicePostAjaxurl = "{php echo $this->createMobileUrl('evaluate', array('op'=>'free','method'=>'ajaxgetlist'));}"
          if(content == '') {
            console.log(1111)
            return
          } else {
            $.post(voicePostAjaxurl,{
              content: content
            },function (data) {
              console.log(data)
          }).then(res=>{
            let $toast = $('#toast')
            if ($toast.css('display') != 'none') return;
              $toast.fadeIn(100);
              setTimeout(function () {
                  $toast.fadeOut(100);
              }, 2000);
          })
          // 提交后清空
          $('.voice_box').val('')
          // 隐藏按钮，避免恶意提交
          $('.voice_message_btn').css('display','none')
          }
        })

        // 学员上进故事分享
        // 学员故事分享
        let articHtml = function(){
          let ajaxurl = "{php echo $this->createMobileUrl('article', array('op'=>'list',cate_id=>$_GPC['cate_id'],'method'=>'ajaxgetlist'));}";
          let articleurl = "{php echo $this->createMobileUrl('article');}";
          let get_status = true; //允许获取状态
          let getData = function () {  
            $.get(ajaxurl, function (data) {
              let jsonObj = JSON.parse(data);
              if (jsonObj.length !== 0) {
                insertDiv(jsonObj);
                console.log(jsonObj)
              }else{
                console.log('获取数据失败')  //没有数据后，禁止请求获取数据
              }
            })
          }
          getData()
          // 内容插入
          let insertDiv =  function(res){
            let storeItems = $('.good_story_items')
            let html = ''
            for(let i = 0; i<res.length; i++){
              html += `
                <li class="good_story_item">
                      <div class="pic">
                        <img src="${res[i].images}" alt="">
                      </div>
                      <p class="text">${res[i].title}</p>
                      <p class="date">${res[i].addtime}</p>
                </li>
              `
            }
            storeItems.append(html)
          }
        }
        articHtml()
      })
    </script>
{template $template.'/_footerv2'}