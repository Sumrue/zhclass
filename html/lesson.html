<!-- 
 * 课程详情页【非直播课程】
 * ============================================================================
 * 版权所有 2015-2020 风影科技，并保留所有权利。
 * 网站地址: https://www.fylesson.com
 * ----------------------------------------------------------------------------
 * 这不是一个自由软件，未购买授权用户无论是否用于商业行为都是侵权行为！
 * 允许已购买用户对程序代码进行修改并在授权域名下使用，但是不允许对程序代码以
 * 任何形式任何目的进行二次发售，作者将依法保留追究法律责任的权力和最终解释权。
 * ============================================================================
-->
{template $template.'/_headerv2'}
<link href="{MODULE_URL}template/mobile/{$template}/style/cssv2/qunService.css?v={$versions}" rel="stylesheet" />
<link href="{MODULE_URL}template/mobile/{$template}/style/cssv2/lesson.css?v={$versions}" rel="stylesheet" />

<div class="header-2 cbox">
	<a href="javascript:;" id="lesson-back" class="ico go-back"></a>
	<div class="flex title">{$title}</div>
	<a href="{php echo $this->createMobileUrl('index', array('t'=>1))}" class="ico go-index"></a>
</div>

{if $poster_show && !$sectionid}
<!-- 赚取佣金 S -->
<div class="sharecard__entry-global max-width-640 ios-system" style="top:50px;" onclick="location.href='{php echo $this->createMobileUrl('lessonqrcode', array('lessonid'=>$id));}'">
	<div class="sharecard__entry">
		<div class="sharecard__entry-icon">
			<img src="{MODULE_URL}template/mobile/{$template}/images/lesson-money.png" />
		</div>
		{if $commisson1_amount && $comsetting['is_sale']}
			{php echo $lesson_page['shareIncome'] ? $lesson_page['shareIncome'] : '赚'.$commisson1_amount.'元';}
		{else}
			{php echo $lesson_page['inviteCard'] ? $lesson_page['inviteCard'] : '邀请卡';}
		{/if}
	</div>
</div>
<!-- 赚取佣金 E -->
{/if}

<div class="content-inner" style="min-height:100%;" onbeforeunload="goodbye()">
	<!-- 视频区域 S -->
	<input type="hidden" id="realPlayTime" value="0" />
	<div id="video-wrap" class="video-wrap">
		{if $_GPC['sectionid']>0}
			{if $section['password'] && !$_SESSION[$uniacid.'_'.$id.'_'.$sectionid]}
				<!-- 密码验证 -->
				<div class="password-wrap">
					<span class="enter-password">{php echo $lesson_page['visit_password'] ? $lesson_page['visit_password'] : '请输入访问密码';}</span>
					<form class="form" action="{$_W['siteurl']}" method="post" id="password_form">
						<input type="password" name="visit_password" placeholder="输入访问密码" />
						<input type="hidden" name="token" value="{$_W['token']}" />
						<button type="submit">提交</button>
					</form>
				</div>
			{else}
				{if $section['sectiontype']==1}
					{if $section['savetype']==2}
						<!-- 内嵌代码方式 -->
						{php echo htmlspecialchars_decode($section['videourl']);}
					{elseif $section['savetype']==5}
						<!-- 腾讯云点播 -->
						<style type="text/css">
						.video-js{width:100%;}
						</style>
						<link href="//imgcache.qq.com/open/qcloud/video/tcplayer/tcplayer.css" rel="stylesheet">
						<script src="//imgcache.qq.com/open/qcloud/video/tcplayer/libs/hls.min.0.12.4.js"></script>
						<script src="//imgcache.qq.com/open/qcloud/video/tcplayer/tcplayer.min.js"></script>
						<video id="player-container-id" width="100%" height="220" preload="auto" x5-playsinline playsinline webkit-playsinline></video>
						<script type="text/javascript">
							var player = TCPlayer('player-container-id', {
								fileID: "<?php echo $section['videourl']; ?>",
								appID : "<?php echo $qcloudvod['appid']; ?>",
								t	  : "<?php echo $qcloudVodRes['t']; ?>",
								us	  : "<?php echo $qcloudVodRes['us']; ?>",
								sign  : "<?php echo $qcloudVodRes['sign']; ?>",
								exper : "<?php echo $exper; ?>",
								autoplay: "{php echo $systemType=='android' && $userAgent ? false : true}",
								poster: "{$_W['attachurl']}{php echo $section['images'] ? $section['images'] : $lesson['images']}",
								plugins:{
									ContinuePlay: {
									   text:'上次播放至 ',
									   btnText: '恢复播放'
									},
									ContextMenu: {
										mirror: true
									},
								  }
							});

							var playing    = true; /* 播放状态 */
							var submiting  = false; /* 提交状态 */
							var space_time = 60;    /* 提交间隔(秒) */
							var uid = "{$uid}";
							var realPlayTime = document.getElementById("realPlayTime").value;
							var recordurl = "{php echo $this->createMobileUrl('record', array('lessonid'=>$_GPC['id'],'sectionid'=>$_GPC['sectionid'],'sectiontype'=>$section['sectiontype']));}";  /* 提交地址 */

							function play(){
								playing = true;
							}
							function pause(){
								playing = false;
							}
							function timeUpdate(){
								//间隔指定时间记录一次播放时间
								var currentTime = Math.floor(player.currentTime());
								var duration = Math.floor(player.duration());
								if(currentTime>0 && currentTime%space_time==0 && !submiting && uid){
									submiting = true;
									$.get(recordurl, {duration:duration,currentTime:currentTime}, function (data){});
									setTimeout(function(){
										submiting = false;
									},1000);
								}

								<?php if($section['is_free']==1 && $section['test_time']>0){ ?>
								var test_time = {php echo $section['test_time'];};
								var plays = {php echo $plays ? 1: 0;};
								if(currentTime >= test_time && !plays && playing){
									player.pause();
									playing = false;
									alert("<?php echo $lesson_page['auditionTip'] ? $lesson_page['auditionTip'] : '试听已结束，观看完整版本请购买'; ?>");
									location.reload();
								}
								<?php } ?>
							}
							function ended(){
								if(uid){
									var currentTime = Math.floor(player.duration());
									var duration = Math.floor(player.duration());
									$.get(recordurl, {duration:duration,currentTime:currentTime}, function (data){});
									$.get(recordurl+'&op=realPlay', {realPlayTime:(realPlayTime%space_time)}, function (data){});
								}
								
								var next_sectionid = "{$next_sectionid}";
								if(next_sectionid){
									window.location.href = "{php echo $this->createMobileUrl('lesson', array('id'=>$id,'sectionid'=>$next_sectionid));}";
								}else{
									location.reload();
								}
							}

							player.on('play', play);
							player.on('pause', pause);
							player.on('timeupdate', timeUpdate);
							player.on('ended', ended);

							setInterval(function(){
								if(playing){
									realPlayTime = parseInt(realPlayTime) + parseInt(1);
									$("#realPlayTime").val(realPlayTime);
								}
								if(realPlayTime!=0 && realPlayTime%space_time==0 && uid){
									$.get(recordurl+'&op=realPlay', {realPlayTime:space_time}, function (data){});
								}
							},1000);

							<?php if($systemType=='ios'){ ?>
								document.addEventListener("WeixinJSBridgeReady", function () {
									document.getElementById('player-container-id_html5_api').play();
								}, false);
							<?php } ?>
						</script>
					{else}
						<!-- 阿里云点播 -->
						<link rel="stylesheet" href="//g.alicdn.com/de/prismplayer/2.8.7/skins/default/aliplayer-min.css" />
						<script type="text/javascript" src="//g.alicdn.com/de/prismplayer/2.8.7/aliplayer-min.js"></script>
						<script type="text/javascript" src="//player.alicdn.com/aliplayer/presentation/js/aliplayercomponents.min.js"></script>
						<div class="prism-player" id="J_prismPlayer"></div>
						<style type="text/css">
						.prism-player .prism-big-play-btn{
							left: 50% !important;
							bottom: 50% !important;
							margin-left: -32px;
							margin-bottom: -32px;
						}
						</style>
						<script>
							var player = new Aliplayer({
								id: "J_prismPlayer",
								width:"100%",
								height:"220px",
								autoplay: "{php echo $systemType=='android' && $userAgent ? false : true}",
								playsinline: true,
								preload: true,
								controlBarVisibility:"click",
								useH5Prism: true,
								isLive: {$section['is_live']},
								showBarTime:"3000",
								useFlashPrism: false,
								x5_type:"",
								x5_video_position:"center",
								x5_fullscreen: false,
								vodRetry: 10,
								cover: "{$_W['attachurl']}{php echo $section['images'] ? $section['images'] : $lesson['images']}",
								<?php if($section['savetype']==4){ ?>
									//阿里云点播
									vid: "{$section['videourl']}",
									playauth: "{$playAuth}",
								<?php }else{ ?>
									//其他存储
									source: "{$section['videourl']}",
								<?php } ?>
								<?php if($m3u8_format){ ?>
									format: "m3u8",
								<?php } ?>
								components:[
									{
										name: 'QualityComponent',
										type: AliPlayerComponent.QualityComponent
									},
									{
										name: 'RotateMirrorComponent',
										type: AliPlayerComponent.RotateMirrorComponent
									},
								<?php if($common['video_watermark'] && $uid){ ?>
									{
										name: 'BulletScreenComponent',
										type: AliPlayerComponent.BulletScreenComponent,
										args: ["{$uid},{$member['mobile']},{$member['nickname']}", {fontSize: '16px', color: '#eeeeee'}, 'random']
									},
								<?php } ?>
								<?php if(!$section['is_live']){ ?>
									{
										name: 'MemoryPlayComponent',
										type: AliPlayerComponent.MemoryPlayComponent,
									},
								<?php } ?>
								],
								<?php if($audio){ ?>
									mediaType: "audio",
								<?php } ?>
							},function (player) {
								player._switchLevel = 0;
								player.on('sourceloaded', function(params) {
									var paramData = params.paramData;
									var desc = paramData.desc;
									var definition = paramData.definition;
									player.getComponent('QualityComponent').setCurrentQuality(desc, definition);
								});

								<?php if($systemType=='ios'){ ?>
									document.addEventListener("WeixinJSBridgeReady", function () {
										var play_video = document.getElementsByTagName('video')[0];
										play_video.play();
									}, false);
								<?php } ?>
							});

							var playing    = true; /* 播放状态 */
							var submiting  = false; /* 提交状态 */
							var space_time = 60;    /* 提交间隔(秒) */
							var uid = "{$uid}";
							var realPlayTime = document.getElementById("realPlayTime").value;
							var recordurl = "{php echo $this->createMobileUrl('record', array('lessonid'=>$_GPC['id'],'sectionid'=>$_GPC['sectionid'],'sectiontype'=>$section['sectiontype']));}";

							var playVideo = function(){
								playing = true;
							}
							var pauseVideo = function(){
								playing = false;
							}
							var timeUpdate = function(){
								//间隔指定时间记录一次播放时间
								var currentTime = Math.floor(player.getCurrentTime());
								var duration = Math.floor(player.getDuration());
								if(currentTime>0 && currentTime%space_time==0 && !submiting && uid){
									submiting = true;
									$.get(recordurl, {duration:duration, currentTime:currentTime}, function (data){});
									setTimeout(function(){
										submiting = false;
									},1000);
								}

								<?php if($section['is_free']==1 && $section['test_time']>0){ ?>
								var test_time = {php echo $section['test_time'];};
								var plays = {php echo $plays ? 1: 0;};
								if(currentTime >= test_time && !plays && playing){
									player.pause();
									playing = false;
									alert("<?php echo $lesson_page['auditionTip'] ? $lesson_page['auditionTip'] : '试听已结束，观看完整版本请购买'; ?>");
									location.reload();
								}
								<?php } ?>
							}
							var ended = function(e){
								if(uid){	
									var currentTime = Math.floor(player.getDuration());
									var duration = Math.floor(player.getDuration());
									$.get(recordurl, {duration:duration, currentTime:currentTime}, function (data){});
									$.get(recordurl+'&op=realPlay', {realPlayTime:(realPlayTime%space_time)}, function (data){});
								}

								var next_sectionid = "{$next_sectionid}";
								if(next_sectionid){
									window.location.href = "{php echo $this->createMobileUrl('lesson', array('id'=>$id,'sectionid'=>$next_sectionid));}";
								}else{
									location.reload();
								}
							}

							player.on('play', playVideo);
							player.on('pause', pauseVideo);
							player.on('timeupdate', timeUpdate);
							player.on('ended', ended);

							setInterval(function(){
								if(playing){
									realPlayTime = parseInt(realPlayTime) + parseInt(1);
									$("#realPlayTime").val(realPlayTime);
								}
								if(realPlayTime!=0 && realPlayTime%space_time==0 && uid){
									$.get(recordurl+'&op=realPlay', {realPlayTime:space_time}, function (data){});
								}
							},1000)

							$(document).ready(function (){
								var video = document.getElementsByTagName('video')[0];
								video.setAttribute("x5-playsinline", "");
							});
						</script>
					{/if}
					<script type="text/javascript">
						var screen_width = document.getElementById('video-wrap').clientWidth;
						var video_height = (screen_width * 9)/16;
						if(screen_width < 500){
							$('#J_prismPlayer').css('height', video_height + 'px');
							$('#player-container-id').css('height', video_height + 'px');
						}
					</script>
				{elseif $section['sectiontype']==3}
				<link rel="stylesheet" href="{MODULE_URL}template/mobile/{$template}/APlayer/APlayer.min.css?v={$versions}">
				<script src="{MODULE_URL}template/mobile/{$template}/APlayer/APlayer.min.js?v={$versions}"></script>
				<div id="main">
					<div class="fylesson_audio">
						<div id="player" class="aplayer"></div>
					</div>
				</div>
				<script>
					var ap1 = new APlayer({
						element: document.getElementById('player'),
						narrow: false,
						autoplay: true,
						showlrc: false,
						music: {
							title: "{$section['title']}",
							author: "",
							url: "{$section['videourl']}",
							pic: "{$_W['attachurl']}{php echo $section['images'] ? $section['images'] : $lesson['images'];}"
						}
					});
					ap1.init();

					var submiting  = false; /* 提交状态 */
					var space_time = 60;    /* 提交间隔(秒) */
					var uid = "{$uid}";
					var playend = false;
					var recordurl = "{php echo $this->createMobileUrl('record', array('lessonid'=>$_GPC['id'],'sectionid'=>$_GPC['sectionid'],'sectiontype'=>$section['sectiontype']));}";

					setInterval(function() {
						var currentTime = document.getElementById("current-ptime").value;
						var duration = Math.floor(ap1.audio.duration);
						<?php if($section['is_free']==1 && $section['test_time']>0){ ?>
						var test_time = {php echo $section['test_time'];};
						var plays = {php echo $plays ? 1: 0;};
						if(currentTime >= test_time && !plays){
							ap1.audio.pause();
							alert("<?php echo $lesson_page['auditionTip'] ? $lesson_page['auditionTip'] : '试听已结束，观看完整版本请购买'; ?>");
							location.reload();
						}
						<?php } ?>

						
						
						//间隔指定时间记录一次播放时间
						if(currentTime>0 && currentTime%space_time==0 && !submiting && uid){
							submiting = true;
							$.get(recordurl, {duration:duration,currentTime:currentTime}, function (data){});
							$.get(recordurl+'&op=realPlay', {realPlayTime:space_time}, function (data){});
							setTimeout(function(){
								submiting = false;
							},1000);
						}

						if(ap1.audio.currentTime == ap1.audio.duration){
							if(!playend && uid){
								playend = true;
								$.get(recordurl, {duration:duration,currentTime:currentTime}, function (data){});
							}
							
							var next_sectionid = "{$next_sectionid}";
							if(next_sectionid){
								window.location.href = "{php echo $this->createMobileUrl('lesson', array('id'=>$id,'sectionid'=>$next_sectionid));}";
							}
						}
					},1000);
				</script>
				{/if}
			{/if}
		{else}
			<img src="{$_W['attachurl']}{$lesson['images']}" alt="{$lesson['bookname']}" width="100%">
			<div class="learned">
				{if $lesson['price']>0}
					{php echo $lesson['buynum']+$lesson['virtual_buynum']+$lesson['vip_number']+$lesson['teacher_number'];}
				{else}
					{php echo $lesson['buynum']+$lesson['virtual_buynum']+$lesson['vip_number']+$lesson['teacher_number']+$lesson['visit_number'];}
				{/if}{php echo $index_page['studyNum'] ? $index_page['studyNum'] : '人已学习';}
			</div>
		{/if}
	</div>
	<!-- 视频区域 E -->

	{if $discount_endtime && !$show_isbuy}
	<!-- 限时折扣 S -->
	<div class="discount-limit-price ios-system">
		<div class="discount-limit-price-left">
			<div class="discount-sale-price weui-flex">
				<span class="discount-sale-num">
					<span class="discount-sale-num-text">￥</span>
					<span class="discount-sale-num-main">{$diacount_price[0]}</span>
					<span class="discount-sale-num-point">.</span>
					<span class="discount-sale-num-sub">{$diacount_price[1]}</span>
				</span>
			<div class="weui-flex-item text-left flash-sale-original">
				<div class="original-cost">￥{$market_price}</div>
					<span class="original-tips">限时折扣</span>
				</div>
			</div>
		</div>
		<div class="discount-limit-price-right discount-sale-countdown text-center">
			<p class="discount-sale-text">距离特价结束仅剩</p>
			<div class="time-item discount-sale-time">
				<span class="discount-sale-time-day" id="time_d">-天</span>
				<span class="discount-sale-time-item" id="time_h">--</span>
				<span class="discount-sale-time-mh">:</span>
				<span class="discount-sale-time-item" id="time_m">--</span>
				<span class="discount-sale-time-mh">:</span>
				<span class="discount-sale-time-item" id="time_s">--</span>
			</div>
		</div> 
	</div>
	<script type="text/javascript">
		setTimeout("show_time()",1000);
		var time_d = document.getElementById("time_d");
		var time_h = document.getElementById("time_h");
		var time_m = document.getElementById("time_m");
		var time_s = document.getElementById("time_s");
		 
		var time_end = new Date("<?php echo $discount_endtime; ?>"); // 设定结束时间
		time_end = time_end.getTime();
		 
		function show_time(){
			var time_now = new Date(); // 获取当前时间
			time_now = time_now.getTime();
			var time_distance = time_end - time_now; // 结束时间减去当前时间
			var int_day, int_hour, int_minute, int_second;
			if(time_distance >= 0){
				// 天时分秒换算
				int_day = Math.floor(time_distance/86400000)
				time_distance -= int_day * 86400000;
				int_hour = Math.floor(time_distance/3600000)
				time_distance -= int_hour * 3600000;
				int_minute = Math.floor(time_distance/60000)
				time_distance -= int_minute * 60000;
				int_second = Math.floor(time_distance/1000)

				// 时分秒为单数时、前面加零站位
				if(int_hour < 10)
				int_hour = "0" + int_hour;
				if(int_minute < 10)
				int_minute = "0" + int_minute;
				if(int_second < 10)
				int_second = "0" + int_second;

				// 显示时间
				time_d.innerHTML = int_day + '天';
				time_h.innerHTML = int_hour;
				time_m.innerHTML = int_minute;
				time_s.innerHTML = int_second;

				setTimeout("show_time()",1000);
			}else{
				time_d.innerHTML = time_d.innerHTML;
				time_h.innerHTML = time_h.innerHTML;
				time_m.innerHTML = time_m.innerHTML;
				time_s.innerHTML = time_s.innerHTML;
			}
		}
		</script>
	<!-- 显示折扣 E -->
	{/if}
	
	<!-- 导航目录 S -->
	<ul class="course-tab flex0_1">
		<li {if $show_defails}class="curr"{/if}>{php echo $lesson_page['details'] ? $lesson_page['details'] : '详情'}</li>
		<li {if $show_dir}class="curr"{/if}>{php echo $lesson_page['directory'] ? $lesson_page['directory'] : '目录'}</li>
		{if $lesson_config['document']}
		<li>{php echo $lesson_page['document'] ? $lesson_page['document'] : '课件'}({php echo count($document_list)})</li>
		{/if}
		{if $lesson_config['evaluate']}
		<li>{php echo $lesson_page['evaluate'] ? $lesson_page['evaluate'] : '评价'}({$total})</li>
		{/if}
	</ul>
	<!-- 导航目录 E -->

	<div class="course-container">
		<!-- 课程介绍 S -->
		<div class="js-tab" {if $show_defails}style="display: block;"{/if}>
			<ul class="course-intro">
				{if !$sectionid || !$section['content']}
					<li style="padding-bottom: 10px;">
						<p class="title-bar__title" onclick="location.href=''">{if $lesson['section_status']==0}<span class="section-status-btn fs-14 vertical-botton">已完结</span>{/if} {$lesson['bookname']}</p>
						<p class="lesson-bar clear">
							<span class="grid_info mar15-left fl ios-system">
								{if $setting['lesson_vip_status']!=1 && !$discount_lesson}
									{if $lesson['price']>0}
										<span class="price index_price_lesson font-bold flex_g0 ios-system">¥{$lesson['price']}</span>
									{else}
										<span class="free flex_g0 ios-system">免费课程</span>
									{/if}
									<span class="mar5 ios-system">|</span>
								{/if}
								{if $section_count}
									<span>{$section_count}节</span>
								{/if}
							</span>
							{if $setting['lesson_vip_status']!=1}
							<span class="vnum fr">
								{if $lesson['integral_rate']>0}
									赠{$lesson['integral_rate']}倍{php echo $common['self_page']['credit1'] ? $common['self_page']['credit1'] : '积分';}
								{elseif $lesson['integral']>0}
									赠{$lesson['integral']}{php echo $common['self_page']['credit1'] ? $common['self_page']['credit1'] : '积分';}
								{/if}
							</span>
							{/if}
						</p>
						<div class="flex1" style="margin: 5px 15px 0 15px;">
							<div class="grid_info flex0">
								{$lesson['teacher']}
							</div>
							<span class="teacher flex_g0">
								{if $setting['stock_config'] && $lesson['stock']>0}
									<span class="fl sale-on-btn">剩余{$lesson['stock']}个名额</span>
								{elseif $setting['stock_config'] && $lesson['stock']==0}
									已售罄
								{/if}
							</span>
						</div>
					</li>
					<li class="details">
						<div class="index_title bor flex1">
							<div class="img flex0">
								<img class="flex_g0" src="{MODULE_URL}template/mobile/{$template}/images/lesson_introduce.png" style="width: 20px;">
							</div>
							<div class="flex_all">{php echo $lesson_page['lessonIntroduce'] ? $lesson_page['lessonIntroduce'] : '课程介绍'}</div>
						</div>
						<div class="lesson-content chapter-content">
							{php echo htmlspecialchars_decode($lesson['descript']);}
						</div>
					</li>
					<li class="details teacher_introduce">
						<div class="index_title bor flex1">
							<div class="img flex0">
								<img class="flex_g0" src="{MODULE_URL}template/mobile/{$template}/images/lesson_teacher_introduce.png" style="width: 20px;">
							</div>
							<div class="flex_all">{php echo $lesson_page['teacherIntroduce'] ? $lesson_page['teacherIntroduce'] : '讲师介绍'}</div>
						</div>
						<div class="chapter-content">
							<p class="teacher-intro">
								<span class="chapter-intro-user" onclick="location.href='{php echo $this->createMobileUrl('teacher', array('teacherid'=>$lesson['teacherid']));}'">
									<img src="{$_W['attachurl']}{$lesson['teacherphoto']}" width="50" height="50" style="display:inline-block;">
									<strong>{$lesson['teacher']}</strong>
									<span>总共{$lessonNumber}{php echo $lesson_page['lessonNum'] ? $lesson_page['lessonNum'] : '个课程'}</span>
									<i class="fa fa-exclamation-circle"> {php echo $lesson_page['allLesson'] ? $lesson_page['allLesson'] : '查看全部课程'}</i>
								</span>
							</p>
							{php echo htmlspecialchars_decode($lesson['teacherdes']);}
						</div>
					</li>
				{else}
					<li class="details">
						<div class="index_title bor flex1">
							<div class="img flex0">
								<img class="flex_g0" src="{MODULE_URL}template/mobile/{$template}/images/lesson_introduce.png" style="width: 20px;">
							</div>
							<div class="flex_all">章节介绍</div>
						</div>
						<div class="lesson-content" style="padding:10px 15px; {if $section['sectiontype']==1}overflow-y:auto; max-height:400px;{/if}">
							{php echo htmlspecialchars_decode($section['content']);}
						</div>
					</li>
				{/if}
			</ul>
		</div>
		<!-- 课程介绍 E -->

		<!-- 章节目录 S -->
		<div class="js-tab" {if $show_dir}style="display: block;"{/if}>
			<ul class="course-chapter">
				<li>
					{if $section_count}
						{loop $title_list $key $title}
						<h2 class="chapter-title" onclick="handleSection(this)"><i class="section-title-icon"></i>{$title['title']}[{php echo count($title['section'])}课时]<span></span></h2>
						<ul class="course-sections">
							{loop $title['section'] $sec}
							<li>
								<a href="javascript:;" onclick="readSection({$sec['id']});" {if $sectionid==$sec['id']}class="section-active"{/if}>
									<div>
										<i class="course-type">
											{if $sec['sectiontype']==1}
												视频
											{elseif $sec['sectiontype']==2}
												图文
											{elseif $sec['sectiontype']==3}
												音频
											{elseif $sec['sectiontype']==4}
												外链
											{/if}
										</i>
										{if ($sec['sectiontype']==1 || $sec['sectiontype']==3) && $sec['password']}
										<i class="fa fa-lock"></i>
										{/if}
										{$sec['title']}
									</div>
									<div class="free-time-content">
										{if $sec['is_free']==1}
										<span class="free-play-box">
											<i class="fa fa-play-circle"></i>
											<i class="free-play-font">免费试听</i>
										</span>
										&nbsp;&nbsp;&nbsp;&nbsp;
										{else}
											{if $lesson_page['playTip']}
												<span class="buy-play-box">
													<i class="fa fa-play-circle"></i>
													<i class="free-play-font">{$lesson_page['playTip']}</i>
												</span>
												&nbsp;&nbsp;&nbsp;&nbsp;
											{/if}
										{/if}

										{if $sec['videotime']}
										<span class="section-time">
											<i class="fa fa-clock-o"></i>
											<i>{$sec['videotime']}</i>
										</span>
										{/if}
									</div>
								</a>
							</li>
							{/loop}
						</ul>
						{/loop}
						
						{if !empty($section_list)}
							{if empty($title_list)}
								<h2 class="chapter-title" onclick="location.href='{php echo $this->createMobileUrl('lesson', array('id'=>$lesson['id']));}'"><i class="section-title-icon"></i>{$lesson['bookname']}[{$section_count}课时]</h2>
							{/if}
							<ul class="course-sections">
							{loop $section_list $sec}
								<li>
									<a href="javascript:;" onclick="readSection({$sec['id']});" {if $sectionid==$sec['id']}class="section-active"{/if}>
										<div>
											<i class="course-type">
												{if $sec['sectiontype']=='1'}
													视频
												{elseif $sec['sectiontype']=='2'}
													图文
												{elseif $sec['sectiontype']=='3'}
													音频
												{elseif $sec['sectiontype']=='4'}
													外链
												{/if}
											</i>
											{if ($sec['sectiontype']==1 || $sec['sectiontype']==3) && $sec['password']}
											<i class="fa fa-lock"></i>
											{/if}
											{$sec['title']}
										</div>
										<div class="free-time-content">
											{if $sec['is_free']==1}
											<span class="free-play-box">
												<i class="fa fa-play-circle"></i>
												<i class="free-play-font">免费试听</i>
											</span>
											&nbsp;&nbsp;&nbsp;&nbsp;
											{else}
												{if $lesson_page['playTip']}
												<span class="buy-play-box">
													<i class="fa fa-play-circle"></i>
													<i class="free-play-font">{$lesson_page['playTip']}</i>
												</span>
												&nbsp;&nbsp;&nbsp;&nbsp;
												{/if}
											{/if}

											{if $sec['videotime']}
											<span class="section-time">
												<i class="fa fa-clock-o"></i>
												<i>{$sec['videotime']}</i>
											</span>
											{/if}
										</div>
									</a>
								</li>
								{/loop}
							</ul>
						{/if}
					{else}
						<h2 class="chapter-title" onclick="location.href='{php echo $this->createMobileUrl('lesson', array('id'=>$lesson['id']));}'"><i class="section-title-icon"></i>{$lesson['bookname']}[{$section_count}课时]</h2>
						<ul class="course-sections">
							<li style="height:auto;padding:10%;">
								<a style="text-align:center;">{php echo $lesson['lesson_type']==0 ? '抱歉，该课程没有找到任何内容~' : '请点击“详情”查看相关介绍哦~';}</a>
							</li>
						</ul>
					{/if}
				</li>
			<ul>
		</div>
		<!-- 章节目录 E -->

		<!-- 课件列表 S -->
		{if $lesson_config['document']}
		<div class="js-tab">
			<ul class="course-chapter">
				<li>
					{if !empty($document_list)}
						<ul class="course-sections">
							{loop $document_list $key $document}
							<li>
								<a href="{if $play}{php echo $this->createMobileUrl('downloadfile', array('fileid'=>$document['id']));}{else}javascript:alert('请您先登录或购买课程');{/if}" class="wxapp-download-tip">
									<div>
										<i class="fa fa-file-text-o"></i>&nbsp;
										{php echo $key+1;}、{$document['title']}
									</div>
								</a>
							</li>
							{/loop}
						</ul>
					{else}
						<ul class="course-sections">
							<li style="height:auto;padding:10%;">
								<a style="text-align:center;">暂时没有任何{php echo $lesson_page['document'] ? $lesson_page['document'] : '课件'}~</a>
							</li>
						</ul>
					{/if}
				</li>
			<ul>
		</div>
		{/if}
		<!-- 课件列表 E -->

		<!-- 评价列表 S -->
		{if $lesson_config['evaluate']}
		<div class="js-tab">
			<div class="evaluate-wrap">
				<div class="evaluate-general" id="evaluate_general">
					<div class="score-general">{$evaluate_score['score']}%</div>
					<div class="score-item">
						<p class="score-title">{php echo $evaluate_page['global_score'] ? $evaluate_page['global_score'] : '综合评分';}</p>
						<p class="score-num">{$evaluate_score['global_score']}</p>
					</div>
					<div class="score-item">
						<p class="score-title">{php echo $evaluate_page['content_score'] ? $evaluate_page['content_score'] : '内容实用';}</p>
						<p class="score-num">{$evaluate_score['content_score']}</p>
					</div>
					<div class="score-item">
						<p class="score-title">{php echo $evaluate_page['understand_score'] ? $evaluate_page['understand_score'] : '通俗易懂';}</p>
						<p class="score-num">{$evaluate_score['understand_score']}</p>
					</div>
				</div>
				{if $allow_evaluate}
				<div class="lesson-evaluate">
					<div class="reply-div">
						有什么想要说的呢？赶紧
						<a class="btn btn-default btn-sm" href="{$evaluate_url}">去评价</a>
						吧~
					</div>
				</div>
				{/if}

				<div class="evaluate-list" id="evaluate_list">
				</div>
			</div>

			<div id="loading_div" class="loading_div">
				<a href="javascript:void(0);" id="btn_Page"><i class="fa fa-arrow-circle-down"></i> 加载更多</a>
			</div>
		</div>
		{/if}
		<!-- 评价列表 E -->
	</div>
	{if !empty($advs)}
	<div style="margin-top: 10px;;">
		<a href="{$advs['link']}"><img src="{$_W['attachurl']}{$advs['picture']}" style="width:100%;"></a>
	</div>
	{/if}
</div>

<div id="loadingToast" style="display: none;">
	<div class="weui-mask_transparent"></div>
	<div class="weui-toast">
		<i class="weui-loading weui-icon_toast"></i>
		<p class="weui-toast__content">数据加载中</p>
	</div>
</div>

{if !empty($lesson['weixin_qrcode'])}
<div id="cover" class="teacher-qrcode max-width-640">
	<div class="qrcode-content">
		<img src="{$_W['attachurl']}{$lesson['weixin_qrcode']}" />
		<p>二维码咨询方式</p>
	</div>
</div>
{/if}

<div id="bottom-contact" class="max-width-640 hide">
	<div class="contact-wrap">
		<div class="contact-wrap-title">咨询交流</div>
		{if !empty($lesson['weixin_qrcode'])}
		<div class="border-top layer-list_item">
			<a href="javascript:;" id="btn-qrcode">
				<div class="layer-list_item-icon">
					<img class="layer-list_item-img" src="{MODULE_URL}template/mobile/default/images/contact-wechat.png">
				</div>
				<p class="layer-list_item-name">微信咨询</p>
				<p class="layer-list_item-info">点击查看二维码</p>
				<div class="layer-list_item-go">
					<i class="icon-font i-v-right">&gt;</i>
				</div>
			</a>
		</div>
		{/if}
		{if !empty($config['tel'])}
		<div class="border-top layer-list_item">
			<a href="tel:{$config['tel']}">
				<div class="layer-list_item-icon">
					<img class="layer-list_item-img" src="{MODULE_URL}template/mobile/{$template}/images/contact-tel.png?v=2">
				</div>
				<p class="layer-list_item-name">客服电话</p>
				<p class="layer-list_item-info">{$config['tel']}</p>
				<div class="layer-list_item-go">
					<i class="icon-font i-v-right">&gt;</i>
				</div>
			</a>
		</div>
		{/if}
		{if !empty($lesson['online_url'])}
		<div class="border-top layer-list_item">
			<a id="qq-consult" href="{$lesson['online_url']}">
				<div class="layer-list_item-icon">
					<img class="layer-list_item-img" src="{MODULE_URL}template/mobile/{$template}/images/contact-online.png">
				</div>
				<p class="layer-list_item-name">在线客服</p>
				<p class="layer-list_item-info">点击咨询客服</p>
				<div class="layer-list_item-go">
					<i class="icon-font i-v-right">&gt;</i>
				</div>
			</a>
		</div>
		{/if}
		{if !empty($lesson['qq'])}
		<div class="border-top layer-list_item">
			<a id="qq-consult" href="http://wpa.qq.com/msgrd?v=3&uin={$lesson['qq']}&site=qq&menu=yes">
				<div class="layer-list_item-icon">
					<img class="layer-list_item-img" src="{MODULE_URL}template/mobile/{$template}/images/contact-1v1.png?v=1">
				</div>
				<p class="layer-list_item-name">QQ咨询</p>
				<p class="layer-list_item-info">QQ:{$lesson['qq']}</p>
				<div class="layer-list_item-go">
					<i class="icon-font i-v-right">&gt;</i>
				</div>
			</a>
		</div>
		{/if}
		{if !empty($lesson['qqgroup'])}
		<div class="contact-wrap__qun border-top">
			<div class="contact-wrap-qun-title">加群交流<span class="contact-wrap-qun-desc">(获取资料、学员交流)</span></div>
			<ul>
				<li class="layer-list_item">
					<a id="qqgroup-consult" {if !empty($lesson['qqgroupLink'])}href="{$lesson['qqgroupLink']}"{/if}>
						<div class="layer-list_item-icon">
							<img class="layer-list_item-img" src="{$_W['attachurl']}{$lesson['teacherphoto']}">
						</div>
						<p class="layer-list_item-name z-tail">{$lesson['teacher']}讲师交流群</p>
						<p class="layer-list_item-info">QQ群:{$lesson['qqgroup']}</p>
						<div class="layer-list_item-go">
							<i class="icon-font i-v-right">&gt;</i>
						</div>
					</a>
				</li>
			</ul>
		</div>
		{/if}
		{if empty($lesson['qq']) && empty($lesson['qqgroup']) && empty($lesson['weixin_qrcode']) && empty($lesson['online_url'])}
		<div class="contact-wrap__qun border-top" style="text-align:center;">
			<div class="contact-wrap-qun-title">抱歉，未找到任何交流方式~</div>
		</div>
		{/if}
	</div>
	<div class="layer-close">关闭</div>
</div>
<div id="layer-bg" class="hide"></div>

<!-- 遮罩层 -->
<div class="flick-menu-mask hide" onclick="closeSpec();"></div>
<!--课程规格start-->
<div class="spec-menu-content max-width-640 spec-menu-show hide">
	<div class="spec-menu-top bdr-b">
		<div class="spec-first-pic">
			<img id="spec_image" src="{$_W['attachurl']}{$lesson['images']}" onerror="imgErr(this)">
		</div>
		<a class="rt-close-btn-wrap spec-menu-close" onclick="closeSpec();">
			<p class="flick-menu-close"></p>
		</a>
		<div class="spec-price" id="specJdPri" style="display: block">
			<span class="yang-pic spec-yang-pic"></span>
			<span id="spec_price"> ￥{$lesson['price']} </span>
		</div>
	</div>
	<div class="spec-menu-middle">
		<div class="prod-spec" id="prodSpecArea">
			<!-- 已选 -->
			<div class="spec-desc">
				<span class="part-note-msg">已选</span>
				<div id="specDetailInfo_lesson" class="base-txt">
				</div>
			</div>
			<div class="nature-container" id="natureCotainer">
				<div class="pro-color">
					<span class="part-note-msg"> 规格 </span>
					<p id="color">
					{if $lesson['lesson_type']==1}
						{loop $spec_list $spec}
							<a class="a-item spec_{$spec['spec_id']}" href="javascript:;" onclick="updateColorSizeSpec('{$spec[spec_id]}','{$spec[spec_price]}','{$spec[spec_day]}','{$spec[spec_name]}')">{$spec['spec_name']}</a>
						{/loop}
					{else}
						{loop $spec_list $spec}
							{if $spec['spec_day']==-1}
							<a class="a-item spec_{$spec['spec_id']}" href="javascript:;" onclick="updateColorSizeSpec('{$spec[spec_id]}','{$spec[spec_price]}','{$spec[spec_day]}','')">长期有效</a>
							{else}
							<a class="a-item spec_{$spec['spec_id']}" href="javascript:;" onclick="updateColorSizeSpec('{$spec[spec_id]}','{$spec[spec_price]}','{$spec[spec_day]}','')">有效期{$spec['spec_day']}天</a>
							{/if}
						{/loop}
					{/if}
					</p>
					<input type="hidden" id="spec_id" value=""/>
				</div>
			</div>
			{if !empty($teacher_price)}
			<div class="nature-container" style="margin-top:10px;">
				<span class="part-note-msg" style="width:60px; line-height:26px;">您也可以</span>
				<div class="base-txt">
					{if !empty($teacher_price)}
						<a href="{php echo $this->createMobileUrl('teacher', array('teacherid'=>$lesson['teacherid']))}" class="buy-teacher">开通讲师服务免费{php echo $lesson_page['studyFont'] ? $lesson_page['studyFont'] : '学习';}</a>
					{/if}
				</div>
			</div>
			{/if}
		</div>
	</div>
	<div class="flick-menu-btn spec-menu-btn">
		<a class="directorder" id="buy_now">{php echo $buynow_name ? $buynow_name : '立即购买';}</a>
	</div>
</div>
<!--课程规格end-->

<!--VIP列表start-->
<div class="spec-menu-content vip-menu-show hide">
	<div class="spec-menu-top bdr-b">
		<div class="spec-first-pic">
			<img id="spec_image" src="{MODULE_URL}template/mobile/{$template}/images/lesson_buy_vip.png" onerror="imgErr(this)">
		</div>
		<a class="rt-close-btn-wrap spec-menu-close" onclick="closeSpec();">
			<p class="flick-menu-close"></p>
		</a>
		<div class="spec-price vip-price-color" style="display: block">
			<span class="yang-pic spec-yang-pic"></span>
			<span id="level_price"></span>
		</div>
	</div>
	<div class="spec-menu-middle">
		<div class="prod-spec">
			<div class="spec-desc" style="margin-bottom: 5px;">
				<span class="part-note-msg" style="width:55px;">已选</span>
				<div id="specDetailInfo_vip" class="base-txt">
				</div>
			</div>
			<div class="nature-container">
				<div class="pro-color">
					<span class="part-note-msg" style="width:55px;">VIP等级</span>
					<p>
					{loop $lesson_vip_list $item}
						<a class="a-item vip_{$item['id']}" href="javascript:;" onclick="selectVipSpec('{$item[id]}','{$item[level_price]}','{$item[level_validity]}','{$item[level_name]}-{$item[level_validity]}天')">{$item[level_name]}-{$item[level_validity]}天</a>
					{/loop}
					</p>
					<input type="hidden" id="vip_id" value=""/>
				</div>
			</div>
			{if $comsetting['vip_agreement']}
			<div class="weui-cells weui-cells_checkbox">
				<label class="weui-cell weui-cell_active weui-check__label" for="vip_agreement">
					<div class="weui-cell__hd" style="padding-right:10px;">
						<input type="checkbox" class="weui-check" id="vip_agreement" checked />
						<i class="weui-icon-checked vip_agreement_checked"></i>
					</div>
					<div class="weui-cell__bd agreement_tips">
						<p>我已阅读并同意<a href="javascript:;" id="view_agreement">《VIP服务协议》</a></p>
					</div>
				</label>
			</div>
			<div class="privacy_agreement_notice-mask" style="display:none;">
				<div class="privacy_agreement_notice">
					<div class="close">
						<img src="{MODULE_URL}template/mobile/default/images/btn-close.png?v=6" width="32" height="32">
					</div>
					<h3 class="notice-title">VIP服务协议</h3>
					<ul class="notice-body">
						{php echo htmlspecialchars_decode($comsetting['vip_agreement'])}<p><br></p>
					</ul>
				</div>
			</div>
			{/if}
		</div>
	</div>
	<div class="flick-menu-btn spec-menu-btn">
		<a class="btn-buy-vip" id="buy_vip">{php echo $config['buy_vip_name'] ? $config['buy_vip_name'] : '开通VIP'}</a>
	</div>
</div>
<!--VIP列表end-->

<ul class="d-buynow max-width-640">
	<li class="btn-qq {if !$lesson_vip_list || $show_isbuy || $setting['lesson_vip_status']<=1 || $lesson['lesson_type'] || ($setting['stock_config'] && !$lesson['stock'])}one-btn-qq{/if}">
		<a href="{php echo $config['service_url'] ? $config['service_url'] : 'javascript:;';}" id="{php echo $config['service_url'] ? 'all-consult' : 'btn-qq';}"><i class="ico ico-lessonqq"></i>咨询</a>
	</li>
	<li class="btn-collect {if !$lesson_vip_list || $show_isbuy || $setting['lesson_vip_status']<=1 || $lesson['lesson_type'] || ($setting['stock_config'] && !$lesson['stock'])}one-btn-collect{/if}" id="btn-collect">
		<a href="javascript:;" {if !empty($collect)}class="cur"{/if}><i class="ico ico-collect"></i>收藏</a>
	</li>

	{if $lesson['lesson_type']==0}
		{if $show_isbuy}
			<li class="btn-buy one-btn-buy"><a href="javascript:;" class="buy buy_now study"><p class="num"><em class="money"></em>{php echo $study_name ? $study_name : '开始学习';}</p></a></li>
		{else}
			{if $setting['stock_config'] && !$lesson['stock']}
				<li class="btn-buy one-btn-buy"><a href="javascript:;" class="buy buy_now gray" style="background-color:#7D7D7D;"><p class="num"><em class="money"></em>已售罄</p></a></li>
			{else}
				{if $setting['lesson_vip_status']==0}
					<!-- 仅显示立即购买 -->
					<li class="btn-buy one-btn-buy no-ios" {if empty($buynow_link) || $buynow_link=='#'}id="buy-now"{/if}><a href="{if !empty($buynow_link) && $buynow_link!='#'}{$buynow_link}{else}javascript:;{/if}" class="buy buy_now red"><p class="num">{php echo $buynow_name ? $buynow_name : '立即购买';}</p></a></li>
					<li class="btn-buy one-btn-buy is-ios" style="display:none;"><a href="javascript:;" class="buy buy_now red"><p class="num">{php echo $buynow_name ? $buynow_name : '立即购买';}</p></a></li>
				{elseif $setting['lesson_vip_status']==1}
					<!-- 仅显示开通VIP -->
					{if $lesson_vip_list}
						<li class="btn-buy one-btn-buy no-ios" id="buy-vip"><a href="javascript:;" class="buy buy_now orange"><p class="num">{php echo $config['buy_vip_name'] ? $config['buy_vip_name'] : '开通VIP'}</p></a></li>
						<li class="btn-buy one-btn-buy is-ios" style="display:none;"><a href="javascript:;" class="buy buy_now orange"><p class="num">{php echo $config['buy_vip_name'] ? $config['buy_vip_name'] : '开通VIP'}</p></a></li>
					{else}
						<li class="btn-buy one-btn-buy no-ios" {if empty($buynow_link) || $buynow_link=='#'}id="buy-now"{/if}><a href="{if !empty($buynow_link) && $buynow_link!='#'}{$buynow_link}{else}javascript:;{/if}" class="buy buy_now red"><p class="num">{php echo $buynow_name ? $buynow_name : '立即购买';}</p></a></li>
						<li class="btn-buy one-btn-buy is-ios" style="display:none;"><a href="javascript:;" class="buy buy_now red"><p class="num">{php echo $buynow_name ? $buynow_name : '立即购买';}</p></a></li>
					{/if}
				{elseif $setting['lesson_vip_status']==2}
					<!-- 显示开通VIP和立即购买 -->
					{if $lesson_vip_list}
						<li class="btn-buy two-btn-buy no-ios" id="buy-vip"><a href="javascript:;" class="buy buy_now orange"><p class="num">{php echo $config['buy_vip_name'] ? $config['buy_vip_name'] : '开通VIP'}</p></a></li>
						<li class="btn-buy two-btn-buy is-ios" style="display:none;"><a href="javascript:;" class="buy buy_now orange"><p class="num">{php echo $config['buy_vip_name'] ? $config['buy_vip_name'] : '开通VIP'}</p></a></li>
					{/if}
					<li class="btn-buy {if $lesson_vip_list}two-btn-buy{else}one-btn-buy{/if} no-ios" {if empty($buynow_link) || $buynow_link=='#'}id="buy-now"{/if}><a href="{if !empty($buynow_link) && $buynow_link!='#'}{$buynow_link}{else}javascript:;{/if}" class="buy buy_now red"><p class="num">{php echo $buynow_name ? $buynow_name : '立即购买';}</p></a></li>
					<li class="btn-buy {if $lesson_vip_list}two-btn-buy{else}one-btn-buy{/if} is-ios" style="display:none;"><a href="javascript:;" class="buy buy_now red"><p class="num">{php echo $buynow_name ? $buynow_name : '立即购买';}</p></a></li>
				{/if}
			{/if}
		{/if}
	{/if}

	{if $lesson['lesson_type']==1}
		{if $show_qrcode}
			<li class="btn-buy one-btn-buy"><a href="{php echo $this->createMobileUrl('orderdetail', array('orderid'=>$apply_order['id']))}" class="buy buy_now blue"><p class="num"><em class="money"></em>{php echo $study_name ? $study_name : '查看二维码';}</p></a></li>
		{else}
			{if $setting['stock_config']==1 && $lesson['stock']==0}
				<li class="btn-buy"><a href="javascript:;" class="buy buy_now gray" style="background-color:#7D7D7D;"><p class="num"><em class="money"></em>已售罄</p></a></li>
			{else}
				<li class="btn-buy one-btn-buy" {if empty($buynow_link) || $buynow_link=='#'}id="buy-now"{/if}><a href="{if !empty($buynow_link) && $buynow_link!='#'}{$buynow_link}{else}javascript:;{/if}" class="buy buy_now red"><p class="num">{php echo $buynow_name ? $buynow_name : '立即购买';}</p></a></li>
			{/if}
		{/if}
	{/if}
</ul>
{if $isfollow['follow_lesson'] && $member['follow']==0 && $userAgent}
<div class="force-contact-main max-width-640 follow_qrcode">
	<div class="force-contact-content_new">
		<p class="force-contact-tips">{php echo $setting['lesson_follow_title'] ? $setting['lesson_follow_title'] : '长按指纹识别二维码, 关注公众号';}</p>
		<p class="force-contact-desc">{php echo $setting['lesson_follow_desc'] ? $setting['lesson_follow_desc'] : '关注后继续学习, 可接收最新课程通知';}</p>
		<img class="receive-red-packet-contact-touch" src="../attachment/images/{$uniacid}/fy_lessonv2/lesson_{$id}.jpg">
	</div>
</div>
{/if}

{if !empty($now_service) && !$go_home}
<div class="aui-dialog">
	<div class="listInformation background_default " style="background: rgb(245, 245, 245);"><span class="listInformationImg listInformationImg2"><img src="{$_W['attachurl']}{$now_service['avatar']}"></span>
		<div class="listInformationWord">
			<p class="t2 c8" style="width: 100%; text-align: left;">HI，我是 {$now_service['nickname']}</p>
			<p class="t1 c2" style="width: 100%; text-align: left;">邀请你加入 用户售后服务群</p>
		</div>
	</div>
	<div class="textCenter" style="padding-top: 0.3rem;">
		<p style="padding-top: 0.3rem;"><img src="{$_W['attachurl']}{$now_service['qrcode']}" class="erweima"></p>
		<p class="t3 c3 padding3" style="line-height: 1.5;">
			微信里长按识别二维码<br>加我为微信好友，拉您入群
		</p>
	</div>
	<div class="listInformationBtn t2 c3 flagDiv"><span onclick="gohome()" class="listInformationBtnChild">好的，已加入</span> <span onclick="closeTip()" class="listInformationBtnChild c5">暂时不用，谢谢</span></div>
</div>
<div class="aui-mask"></div>
<script type="text/javascript">
var htmlDom = document.documentElement;
var windowWidth = htmlDom.clientWidth;
htmlDom.style.fontSize = windowWidth / 7.5 + 'px';
(function() {
	document.addEventListener('DOMContentLoaded', function() {
		if(!htmlDom.style.fontSize) {
			var htmlDomProtect = document.documentElement;
			var windowWidth = htmlDomProtect.clientWidth;
			htmlDomProtect.style.fontSize = windowWidth / 7.5 + 'px';
		}
	}, false);
})();

function closeTip(){
	$(".aui-dialog").hide();
	$(".aui-mask").hide();
}
function gohome(){
	$.ajax({
		url:"{php echo $this->createMobileUrl('vip', array('op'=>'gohome'));}",
		type:"post",
		data:{},
		success:function(data){
			if(data==0){
				alert("网络请求失败，请稍后再试!");
			}
			closeTip();
		},
		error:function(e){
			alert("网络错误，请稍后重试!");
			closeTip();
		}
	}); 
}
</script>
{/if}

<script type="text/javascript">
var ajaxurl = "{php echo $this->createMobileUrl('getevaluate', array('id'=>$id));}";
var get_status = true; //允许获取状态

$(function () {
    var nowPage = 1;
    function getData(page) {
        if(get_status){
			nowPage++;
			$.get(ajaxurl, {page: page}, function (data) {
				var jsonObj = JSON.parse(data);
				if (jsonObj.length > 0) {
					insertDiv(jsonObj);
				}else{
					get_status = false;
					document.getElementById("loading_div").innerHTML='<div class="loading_bd">没有了，已经到底了</div>';
				}
			});
		}
    } 
    //初始化加载第一页数据  
    getData(1);

    //生成数据html,append到div中  
    function insertDiv(result) {  
        var mainDiv =$("#evaluate_list");
        var chtml = '';  
        for (var j = 0; j < result.length; j++) {
			chtml += '<div class="evaluate-item">';
			chtml += '	<div class="item-head clearfix">';
			chtml += '		<div class="commenter-box clearfix">';
			chtml += '			<img src="' + result[j].avatar + '">';
			chtml += '			<span>' + result[j].nickname + '</span>';
			chtml += '			<p class="time">' + result[j].addtime + '</p>';
			chtml += '		</div>';
			chtml += '		<div class="item-head-right">';
			chtml += '			<span class="star-wrap clearfix">';
			chtml += '				<img src="' + result[j].grade_ico + '">';
			chtml += '				<i>' + result[j].grade + '</i>';
			chtml += '			</span>';
			chtml += '		</div>';
			chtml += '	</div>';
			chtml += '	<p class="item-content content-pre">' + result[j].content + '</p>';
			if(result[j].reply !=null && result[j].reply !=''){
				chtml += '<p class="item-reply">讲师回复：' + result[j].reply + '</p>';
			}
			chtml += '</div>';
        }
		mainDiv.append(chtml);
    }  
  
    //定义鼠标滚动事件
	var scroll_loading = false;
    $(window).scroll(function(){
	　　var scrollTop = $(this).scrollTop();
	　　var scrollHeight = $(document).height();
	　　var windowHeight = $(this).height();
	　　if(scrollTop + windowHeight >= scrollHeight && !scroll_loading){
			scroll_loading = true;
			getData(nowPage);  
			scroll_loading = false;
	　　}
	});
    $("#btn_Page").click(function () {
        getData(nowPage);
    });

    
    //单规格课程自动选中    
    <?php if(count($spec_list)==1){ ?>
	    var spec_id = <?php echo $spec_list[0]['spec_id']; ?>;
	    var spec_price = <?php echo $spec_list[0]['spec_price']; ?>;
	    var spec_day = <?php echo $spec_list[0]['spec_day']; ?>;
		var spec_name = "<?php echo $spec_list[0]['spec_name']; ?>";
	    updateColorSizeSpec(spec_id, spec_price, spec_day, spec_name);
	<?php } ?>
});

</script>

<script type="text/javascript">
var iosBuyTip = '';
document.addEventListener('WeixinJSBridgeReady', function onBridgeReady() {
	var miniprogram_environment = false;
	wx.miniProgram.getEnv(function(res) {
		if(res.miniprogram) {
			miniprogram_environment = true;
		}
	})
	if((window.__wxjs_environment === 'miniprogram' || miniprogram_environment)) {
		wx.miniProgram.getEnv(function(res) {
			wx.miniProgram.postMessage({ 
				data: {
					'title': "{$sharelesson['title']}",
					'images': "{$sharelesson['images']}",
				}
			})
		});
		$("#qq-consult").attr("href","javascript:;");
		$("#qqgroup-consult").attr("href","javascript:;");
		$("#all-consult").attr("href","javascript:;");
		$(".follow_qrcode").hide();

		<?php if($systemType=='ios'){ ?>
			iosBuyTip = "{php echo $lesson_page['iosBuyTip'] ? $lesson_page['iosBuyTip'] : '根据小程序运营规范相关规定，iOS版小程序不支持开通VIP或购买课程'}";
			$('.no-ios').hide();
			$('.is-ios').show();
			$('.is-ios').click(function(){
				alert(iosBuyTip);
			})
		<?php } ?>

		$(".wxapp-download-tip").click(function(){
			alert("小程序环境暂不支持下载");
		})
	}
});

function readSection(sectionid){
	var lessonid = "{$lesson['id']}";
	$("#loadingToast").show();

	$.ajax({
		type: 'get',
		url: "{php echo $this->createMobileUrl('sectionstudystatus')}",
		data: {id:lessonid, sectionid:sectionid},
		dataType: 'json',     
		success: function(data){
			$("#loadingToast").hide();
			if(data.code==0){
				location.href = "{php echo $this->createMobileUrl('lesson')}&id=" + lessonid + "&sectionid=" + sectionid;
			}else if(data.code==-99){
				alert(iosBuyTip ? iosBuyTip : data.msg);
			}else{
				alert(data.msg);
			}
		},
		error: function(error){
			$("#loadingToast").hide();
			alert('网络繁忙，请稍候重试');
		}
	});
}
</script>

<script type="text/javascript">
// “章节”、“课程详情”tab切换
$(".course-tab").on("click", 'li', function() {
	var $currItem = $(this),
	index = $currItem.index();

	$currItem.addClass('curr').siblings().removeClass('curr');
	$(".js-tab").hide().eq(index).show();

});

//展开和关闭章节
function handleSection(obj){
	$(obj).find('span').toggleClass("open");
	$(obj).next('ul').toggleClass("hide");
}

//展开咨询
$("#btn-qq").click(function() {
	$("#bottom-contact").removeClass("hide");
	$("#layer-bg").removeClass("hide");
});
//关闭咨询
$(".layer-close").click(function() {
	$("#bottom-contact").addClass("hide");
	$("#layer-bg").addClass("hide");

});

//微信二维码
$('#btn-qrcode').click(function(){
	$('#cover').fadeIn(200).unbind('click').click(function(){
		$(this).fadeOut(100);
	})
});

//课程规格
$("#buy-now").click(function() {
	$(".flick-menu-mask").removeClass('hide');
	$(".spec-menu-show").removeClass('hide');
});
//购买课程下一步
$("#buy_now").click(function(){
	var spec_id = $("#spec_id").val();
	if(!spec_id){
		alert("请选择课程规格");
		return false;
	}
	location.href = "{php echo $this->createMobileUrl('confirm', array('id'=>$lesson['id']));}&spec_id="+spec_id;
});
//关闭课程和VIP规格
function closeSpec(){
	$(".flick-menu-mask").addClass('hide');
	$(".spec-menu-show").addClass('hide');
	$(".vip-menu-show").addClass('hide');
}

//查看VIP服务协议
$("#view_agreement").click(function(){
	$('.privacy_agreement_notice-mask').fadeIn(200).unbind('click').click(function(){
		$(this).fadeOut(100);
	})
});

//开通VIP
$("#buy-vip").click(function() {
	$(".flick-menu-mask").removeClass('hide');
	$(".vip-menu-show").removeClass('hide');
});
//提交VIP订单
$("#buy_vip").click(function(){
	var vip_id = $("#vip_id").val();
	if(!vip_id){
		alert("请选择要购买的VIP等级");
		return false;
	}

	<?php if($comsetting['vip_agreement']){ ?>
	if(!$("#vip_agreement").is(':checked')){
		alert("请阅读并同意VIP服务协议");
		return false;
	}
	<?php } ?>

	location.href = "{php echo $this->createMobileUrl('vip', array('op'=>'buyvip'));}&level_id="+vip_id;
});


//收藏按钮
<?php if($uid){ ?>
	$("#btn-collect").click(function(){
		var id = "<?php echo $id; ?>";
		var ajaxurl = "{php echo $this->createMobileUrl('updatecollect', array('ctype'=>'lesson'));}";
		$.ajax({
			type:'post',
			url:ajaxurl,
			data:{id:id},
			dataType:'json',     
			success:function(data){
				if(data=='1'){
					$("#btn-collect a").addClass("cur");
				}else if(data=='2'){
					$("#btn-collect a").removeClass("cur");
				}
			}
		});
	});
<?php } ?>

//开始学习
var sectionid = "{$sectionid}";
var study_url = "{php echo $study_link ? $study_link : $this->createMobileUrl('lesson', array('id'=>$lesson['id'],'sectionid'=>$first_section['id']));}";
var study_tips = "{php echo $lesson_page['study_tips'] ? $lesson_page['study_tips'] : '如视频没有播放，请点击画面中的播放按钮'}";
$(".study").click(function(){
	if(sectionid==0){
		window.location.href = study_url;
	}else{
		alert(study_tips);
	}
})

//选择课程规格
function updateColorSizeSpec(spec_id, spec_price, spec_day, spec_name){
	$(".a-item").removeClass("selected");
	$(".spec_"+spec_id).addClass("selected");
	$("#spec_id").val(spec_id);
	document.getElementById("spec_price").innerHTML = "￥"+spec_price;

	{if $lesson['lesson_type'] == 1}
		document.getElementById("specDetailInfo_lesson").innerHTML = spec_name;
	{else}
		document.getElementById("specDetailInfo_lesson").innerHTML = spec_day==-1 ? '长期有效' : "有效期"+spec_day+"天";
	{/if}
}

//选择vip规则
function selectVipSpec(level_id, level_price, level_validity, level_name){
	$(".a-item").removeClass("vip-selected");
	$(".vip_"+level_id).addClass("vip-selected");
	$("#vip_id").val(level_id);
	document.getElementById("level_price").innerHTML = "￥"+level_price;

	document.getElementById("specDetailInfo_vip").innerHTML = level_name;
}
</script>

<script type="text/javascript">
wx.ready(function(){
	var shareData = {
		title: "{$sharelesson['title']}",
		desc: "{$sharelesson['desc']}",
		link: "{$sharelesson['link']}",
		imgUrl: "{$sharelesson['images']}",
		trigger: function (res) {},
		complete: function (res) {},
		success: function (res) {
			$.post("{php echo $this->createMobileUrl('sharecoupon');}");
		},
		cancel: function (res) {},
		fail: function (res) {}
	};
	wx.onMenuShareTimeline(shareData);
	wx.onMenuShareAppMessage(shareData);
	wx.onMenuShareQQ(shareData);
	wx.onMenuShareWeibo(shareData);
	wx.onMenuShareQZone(shareData);
});
</script>

{template $template.'/_footerv2'}
